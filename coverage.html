<!DOCTYPE html>

<!--
    This html layout is shamelessly lifted from TJ Holowaychuk's mocha project, with
    the following license.  All mods I made are available under the same license.

    (The MIT License)

    Copyright (c) 2011-2013 TJ Holowaychuk <tj@vision-media.ca>

    Permission is hereby granted, free of charge, to any person obtaining
    a copy of this software and associated documentation files (the
    'Software'), to deal in the Software without restriction, including
    without limitation the rights to use, copy, modify, merge, publish,
    distribute, sublicense, and/or sell copies of the Software, and to
    permit persons to whom the Software is furnished to do so, subject to
    the following conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
    MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
    IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
    CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
    TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
    SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->

<html>
  <head>
    <title>Coverage</title>
    <script>

headings = [];

onload = function(){
  headings = document.querySelectorAll('h2');
};

onscroll = function(e){
  var heading = find(window.scrollY);
  if (!heading) return;
  var links = document.querySelectorAll('#menu a')
    , link;

  for (var i = 0, len = links.length; i < len; ++i) {
    link = links[i];
    link.className = link.getAttribute('href') == '#' + heading.id
      ? 'active'
      : '';
  }
};

function find(y) {
  var i = headings.length
    , heading;

  while (i--) {
    heading = headings[i];
    if (y >= heading.offsetTop) {
      return heading;
    }
  }
}
</script>
<style>

body {
  font: 14px/1.6 "Helvetica Neue", Helvetica, Arial, sans-serif;
  margin: 0;
  color: #2C2C2C;
  border-top: 2px solid #ddd;
}

.template {
  display: none;
}

#coverage {
  padding: 60px;
}

h1 a {
  color: inherit;
  font-weight: inherit;
}

h1 a:hover {
  text-decoration: none;
}

.onload h1 {
  opacity: 1;
}

h2 {
  width: 80%;
  margin-top: 80px;
  margin-bottom: 0;
  font-weight: 100;
  letter-spacing: 1px;
  border-bottom: 1px solid #eee;
}

a {
  color: #8A6343;
  font-weight: bold;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

ul {
  margin-top: 20px;
  padding: 0 15px;
  width: 100%;
}

ul li {
  float: left;
  width: 40%;
  margin-top: 5px;
  margin-right: 60px;
  list-style: none;
  border-bottom: 1px solid #eee;
  padding: 5px 0;
  font-size: 12px;
}

ul::after {
  content: '.';
  height: 0;
  display: block;
  visibility: hidden;
  clear: both;
}

code {
  font: 12px monaco, monospace;
}

pre {
  margin: 30px;
  padding: 30px;
  border: 1px solid #eee;
  border-bottom-color: #ddd;
  -webkit-border-radius: 2px;
  -moz-border-radius: 2px;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 0 10px #eee;
  -moz-box-shadow: inset 0 0 10px #eee;
  box-shadow: inset 0 0 10px #eee;
  overflow-x: auto;
}

img {
  margin: 30px;
  padding: 1px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  -moz-box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  box-shadow: 0 3px 10px #dedede, 0 1px 5px #888;
  max-width: 100%;
}

footer {
  background: #eee;
  width: 100%;
  padding: 50px 0;
  text-align: right;
  border-top: 1px solid #ddd;
}

footer span {
  display: block;
  margin-right: 30px;
  color: #888;
  font-size: 12px;
}

#menu {
  position: fixed;
  font-size: 12px;
  overflow-y: auto;
  top: 0;
  right: 0;
  margin: 0;
  height: 100%;
  padding: 15px 0;
  text-align: right;
  border-left: 1px solid #eee;
  -moz-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  box-shadow: 0 0 2px #888
     , inset 5px 0 20px rgba(0,0,0,.5)
     , inset 5px 0 3px rgba(0,0,0,.3);
  -webkit-font-smoothing: antialiased;
  background: url("data:image/png;base64,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");
}

#menu::after {
  display: block;
  content: '';
  padding-top: 80px;
}

#logo {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: rgba(255,255,255,.1);
  font-size: 11px;
  display: block;
  width: 20px;
  height: 20px;
  line-height: 20px;
  text-align: center;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  -webkit-box-shadow: 0 0 3px rgba(0,0,0,.2);
  -moz-box-shadow: 0 0 3px rgba(0,0,0,.2);
  box-shadow: 0 0 3px rgba(0,0,0,.2);
  color: inherit;
}

#menu li a {
  display: block;
  color: white;
  padding: 0 35px 0 25px;
  -webkit-transition: background 300ms;
  -moz-transition: background 300ms;
}

#menu li {
  position: relative;
  list-style: none;
}

#menu a:hover,
#menu a.active {
  text-decoration: none;
  background: rgba(255,255,255,.1);
}

#menu li:hover .cov {
  opacity: 1;
}

#menu li .dirname {
  opacity: .60;
  padding-right: 2px;
}

#menu li .basename {
  opacity: 1;
}

#menu .cov {
  background: rgba(0,0,0,.4);
  position: absolute;
  top: 0;
  right: 8px;
  font-size: 9px;
  opacity: .6;
  text-align: left;
  width: 17px;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
  border-radius: 10px;
  padding: 2px 3px;
  text-align: center;
}

.stats:nth-child(2n) {
  display: inline-block;
  margin-top: 15px;
  border: 1px solid #eee;
  padding: 10px;
  -webkit-box-shadow: inset 0 0 2px #eee;
  -moz-box-shadow: inset 0 0 2px #eee;
  box-shadow: inset 0 0 2px #eee;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border-radius: 5px;
}

.stats div {
  float: left;
  padding: 0 5px;
}

.stats::after {
  display: block;
  content: '';
  clear: both;
}

.stats .sloc::after {
  content: ' SLOC';
  color: #b6b6b6;
}

.stats .percentage::after {
  content: ' coverage';
  color: #b6b6b6;
}

.stats .hits,
.stats .misses {
  display: none;
}

.high {
  color: #00d4b4;
}
.medium {
  color: #e87d0d;
}
.low {
  color: #d4081a;
}
.terrible {
  color: #d4081a;
  font-weight: bold;
}

table {
  width: 80%;
  margin-top: 10px;
  border-collapse: collapse;
  border: 1px solid #cbcbcb;
  color: #363636;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
}

table thead {
  display: none;
}

table td.line,
table td.hits {
  width: 20px;
  background: #eaeaea;
  text-align: center;
  font-size: 11px;
  padding: 0 10px;
  color: #949494;
}

table td.hits {
  width: 10px;
  padding: 2px 5px;
  color: rgba(0,0,0,.2);
  background: #f0f0f0;
}

tr.miss td.line,
tr.miss td.hits {
  background: #e6c3c7;
}

tr.miss td {
  background: #f8d5d8;
}

td.source {
  padding-left: 15px;
  line-height: 15px;
  white-space: pre;
  font: 12px monaco, monospace;
}

code .comment { color: #ddd }
code .init { color: #2F6FAD }
code .string { color: #5890AD }
code .keyword { color: #8A6343 }
code .number { color: #2F6FAD }
</style>
  </head>
  <body>
    <div id="coverage">
      <h1 id="overview">Coverage</h1>
      <div id="menu">
        <li><a href="#overview">overview</a></li>
        <li class="template">
          <span class="cov high"></span>
          <a href=""><span class="dirname"></span><span class="basename"></span></a>
        </li>
      <li class="">
          <span class="cov high">100%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/index.js">/home/luis/noboxout/noboxout-orm/index.js</a>
        </li><li class="">
          <span class="cov high">98%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/lib/norm.js">/home/luis/noboxout/noboxout-orm/lib/norm.js</a>
        </li><li class="">
          <span class="cov high">87%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/lib/entity.js">/home/luis/noboxout/noboxout-orm/lib/entity.js</a>
        </li><li class="">
          <span class="cov high">90%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/lib/relation.js">/home/luis/noboxout/noboxout-orm/lib/relation.js</a>
        </li><li class="">
          <span class="cov high">55%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/lib/dba.js">/home/luis/noboxout/noboxout-orm/lib/dba.js</a>
        </li><li class="">
          <span class="cov high">80%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/lib/query.js">/home/luis/noboxout/noboxout-orm/lib/query.js</a>
        </li><li class="">
          <span class="cov high">NaN%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/lib/mysql.js">/home/luis/noboxout/noboxout-orm/lib/mysql.js</a>
        </li><li class="">
          <span class="cov high">100%</span>
          <a href="#/home/luis/noboxout/noboxout-orm/test/test-models.js">/home/luis/noboxout/noboxout-orm/test/test-models.js</a>
        </li></div>
      <div id="stats" class="stats high">
        <div class="percentage">85.4%</div>
        <div class="sloc">583</div>
        <div class="hits">498</div>
        <div class="misses">85</div>
      </div>
      <div id="files">
        <div class="file template">
          <h2></h2>
          <div class="stats high">
            <div class="percentage"></div>
            <div class="sloc"></div>
            <div class="hits"></div>
            <div class="misses"></div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            </tbody>
          </table>
        </div>
      <div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/index.js">/home/luis/noboxout/noboxout-orm/index.js</h2>
          <div class="stats high">
            <div class="percentage">100.0%</div>
            <div class="sloc">28</div>
            <div class="hits">28</div>
            <div class="misses">0</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">Object.defineProperty(global, &quot;__stack&quot;, {</td></tr><tr class=""><td class="line">2</td><td class="hits"></td><td class="source">    get: function () {</td></tr><tr class="hit"><td class="line">3</td><td class="hits">386</td><td class="source">        var orig = Error.prepareStackTrace,</td></tr><tr class=""><td class="line">4</td><td class="hits"></td><td class="source">            err,</td></tr><tr class=""><td class="line">5</td><td class="hits"></td><td class="source">            stack;</td></tr><tr class=""><td class="line">6</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">7</td><td class="hits">386</td><td class="source">        Error[&quot;prepareStackTrace&quot;]=function(){</td></tr><tr class="hit"><td class="line">8</td><td class="hits">386</td><td class="source">            return arguments[1];</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        };</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">11</td><td class="hits">386</td><td class="source">        err = new Error();</td></tr><tr class="hit"><td class="line">12</td><td class="hits">386</td><td class="source">        Error.captureStackTrace(err, arguments.callee);</td></tr><tr class=""><td class="line">13</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">14</td><td class="hits">386</td><td class="source">        stack = err.stack;</td></tr><tr class=""><td class="line">15</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">16</td><td class="hits">386</td><td class="source">        Error.prepareStackTrace = orig;</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">18</td><td class="hits">386</td><td class="source">        return stack;</td></tr><tr class=""><td class="line">19</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source">});</td></tr><tr class=""><td class="line">21</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">22</td><td class="hits">3</td><td class="source">Object.defineProperty(global, &quot;__line&quot;, {</td></tr><tr class=""><td class="line">23</td><td class="hits"></td><td class="source">    get: function () {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">193</td><td class="source">        return __stack[2].getLineNumber();</td></tr><tr class=""><td class="line">25</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">26</td><td class="hits"></td><td class="source">});</td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">28</td><td class="hits">3</td><td class="source">Object.defineProperty(global, &quot;__file&quot;, {</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">    get: function () {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">193</td><td class="source">        return __stack[2].getFileName().split(&quot;/&quot;).slice(-1)[0];</td></tr><tr class=""><td class="line">31</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">32</td><td class="hits"></td><td class="source">});</td></tr><tr class=""><td class="line">33</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">34</td><td class="hits">3</td><td class="source">(function () {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">36</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">37</td><td class="hits">3</td><td class="source">    require(&quot;function-enhancements&quot;);</td></tr><tr class="hit"><td class="line">38</td><td class="hits">3</td><td class="source">    require(&quot;object-enhancements&quot;);</td></tr><tr class="hit"><td class="line">39</td><td class="hits">3</td><td class="source">    require(&quot;array-enhancements&quot;);</td></tr><tr class=""><td class="line">40</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">41</td><td class="hits">3</td><td class="source">    var winston = require(&quot;winston&quot;),</td></tr><tr class=""><td class="line">42</td><td class="hits"></td><td class="source">        util = require(&quot;util&quot;),</td></tr><tr class=""><td class="line">43</td><td class="hits"></td><td class="source">        logger = new (winston.Logger)({</td></tr><tr class=""><td class="line">44</td><td class="hits"></td><td class="source">            transports: [</td></tr><tr class=""><td class="line">45</td><td class="hits"></td><td class="source">                new (winston.transports.Console)(), //({ raw: true }),</td></tr><tr class=""><td class="line">46</td><td class="hits"></td><td class="source">            ]</td></tr><tr class=""><td class="line">47</td><td class="hits"></td><td class="source">        });</td></tr><tr class=""><td class="line">48</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">49</td><td class="hits">3</td><td class="source">    util.inspect.styles.undefined = &quot;red&quot;;</td></tr><tr class="hit"><td class="line">50</td><td class="hits">3</td><td class="source">    util.inspect.styles.date = &quot;green&quot;;</td></tr><tr class=""><td class="line">51</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">52</td><td class="hits">3</td><td class="source">    global.log = function () {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">193</td><td class="source">        var args = Array.prototype.slice.call(arguments).map(function (v, i) {</td></tr><tr class="hit"><td class="line">54</td><td class="hits">364</td><td class="source">            return (&quot;string&quot; === typeof v ? v.trim() : util.inspect(v, {depth: 5, colors: true}));</td></tr><tr class=""><td class="line">55</td><td class="hits"></td><td class="source">        }).join(&quot; - &quot;);</td></tr><tr class=""><td class="line">56</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">57</td><td class="hits">193</td><td class="source">        logger.info(__file, __line, args);</td></tr><tr class=""><td class="line">58</td><td class="hits"></td><td class="source">    };</td></tr><tr class=""><td class="line">59</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">60</td><td class="hits">3</td><td class="source">    module.exports.Norm = require(&quot;/home/luis/noboxout/noboxout-orm/./lib/norm.js&quot;);</td></tr><tr class="hit"><td class="line">61</td><td class="hits">3</td><td class="source">    module.exports.DBA = require(&quot;/home/luis/noboxout/noboxout-orm/./lib/dba.js&quot;);</td></tr><tr class="hit"><td class="line">62</td><td class="hits">3</td><td class="source">    module.exports.Mysql = require(&quot;/home/luis/noboxout/noboxout-orm/./lib/mysql.js&quot;);</td></tr><tr class=""><td class="line">63</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">64</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source">}());</td></tr><tr class=""><td class="line">66</td><td class="hits"></td><td class="source"></td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/lib/norm.js">/home/luis/noboxout/noboxout-orm/lib/norm.js</h2>
          <div class="stats high">
            <div class="percentage">98.1%</div>
            <div class="sloc">53</div>
            <div class="hits">52</div>
            <div class="misses">1</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">(function () {</td></tr><tr class="hit"><td class="line">2</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">3</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">4</td><td class="hits">3</td><td class="source">    require(&quot;/home/luis/noboxout/noboxout-orm/lib/./entity.js&quot;);</td></tr><tr class=""><td class="line">5</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">6</td><td class="hits">3</td><td class="source">    var object = require(&quot;object-enhancements&quot;),</td></tr><tr class=""><td class="line">7</td><td class="hits"></td><td class="source">        $ = require(&quot;node-class&quot;),</td></tr><tr class=""><td class="line">8</td><td class="hits"></td><td class="source">        __class = $.class,</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        __static = $.static,</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source">        Norm,</td></tr><tr class=""><td class="line">11</td><td class="hits"></td><td class="source">        dba;</td></tr><tr class=""><td class="line">12</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">13</td><td class="hits">3</td><td class="source">    Norm = __class(&quot;norm/norm&quot;, {</td></tr><tr class=""><td class="line">14</td><td class="hits"></td><td class="source">        &quot;static setDBA&quot;: function (_dba) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">3</td><td class="source">            dba = _dba;</td></tr><tr class=""><td class="line">16</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source">        &quot;static define&quot;: function (name, definition, options) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">9</td><td class="source">            options = options || {};</td></tr><tr class="hit"><td class="line">19</td><td class="hits">9</td><td class="source">            options.autoset = true;</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">21</td><td class="hits">9</td><td class="source">            definition.extends = definition.extends || [];</td></tr><tr class="hit"><td class="line">22</td><td class="hits">9</td><td class="source">            definition.extends.push(&quot;Norm/Entity&quot;);</td></tr><tr class="hit"><td class="line">23</td><td class="hits">9</td><td class="source">            definition.$dirty = false;</td></tr><tr class=""><td class="line">24</td><td class="hits"></td><td class="source">            // search for $dbtype</td></tr><tr class="hit"><td class="line">25</td><td class="hits">9</td><td class="source">            var i,</td></tr><tr class=""><td class="line">26</td><td class="hits"></td><td class="source">                $table = {</td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source">                    tableName: options.tableName || name.toLowerCase(),</td></tr><tr class=""><td class="line">28</td><td class="hits"></td><td class="source">                    primaryKey: options.primaryKey || &quot;id&quot;,</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">                    prefix: options.prefix || &quot;&quot;,</td></tr><tr class=""><td class="line">30</td><td class="hits"></td><td class="source">                    fields: [],</td></tr><tr class=""><td class="line">31</td><td class="hits"></td><td class="source">                    structure: {},</td></tr><tr class=""><td class="line">32</td><td class="hits"></td><td class="source">                    updatedAt: options.updatedAt || &quot;updated_at&quot;,</td></tr><tr class=""><td class="line">33</td><td class="hits"></td><td class="source">                    createdAt: options.createdAt || &quot;created_at&quot;,</td></tr><tr class=""><td class="line">34</td><td class="hits"></td><td class="source">                    timestamps: options.timestamps === undefined ? true : options.timestamps,</td></tr><tr class=""><td class="line">35</td><td class="hits"></td><td class="source">                    relations: [],</td></tr><tr class=""><td class="line">36</td><td class="hits"></td><td class="source">                    foreignKeys: {}</td></tr><tr class=""><td class="line">37</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">38</td><td class="hits"></td><td class="source">                },</td></tr><tr class=""><td class="line">39</td><td class="hits"></td><td class="source">                $data = {};</td></tr><tr class=""><td class="line">40</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">41</td><td class="hits">9</td><td class="source">            for (i in definition) {</td></tr><tr class="hit"><td class="line">42</td><td class="hits">48</td><td class="source">                if (definition[i] &amp;&amp; definition[i].$dbtype) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">21</td><td class="source">                    $table.fields.push(i);</td></tr><tr class="hit"><td class="line">44</td><td class="hits">21</td><td class="source">                    $table.structure[i] = definition[i];</td></tr><tr class="hit"><td class="line">45</td><td class="hits">21</td><td class="source">                    $data[i] = definition[i].default;</td></tr><tr class="hit"><td class="line">46</td><td class="hits">21</td><td class="source">                    delete definition[i];</td></tr><tr class=""><td class="line">47</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">48</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">49</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">50</td><td class="hits"></td><td class="source">            // check if PK exists</td></tr><tr class="hit"><td class="line">51</td><td class="hits">9</td><td class="source">            if ($table.fields.indexOf($table.primaryKey) === -1) {</td></tr><tr class="miss"><td class="line">52</td><td class="hits">0</td><td class="source">                throw new Error(&quot;primary key not found&quot;);</td></tr><tr class=""><td class="line">53</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">54</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">55</td><td class="hits"></td><td class="source">            // add timestamp fields</td></tr><tr class="hit"><td class="line">56</td><td class="hits">9</td><td class="source">            if ($table.timestamps) {</td></tr><tr class="hit"><td class="line">57</td><td class="hits">9</td><td class="source">                $table.fields.push($table.updatedAt);</td></tr><tr class="hit"><td class="line">58</td><td class="hits">9</td><td class="source">                $table.fields.push($table.createdAt);</td></tr><tr class=""><td class="line">59</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">60</td><td class="hits">9</td><td class="source">                $table.structure[$table.updatedAt] = Norm.Date;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">9</td><td class="source">                $table.structure[$table.createdAt] = Norm.Date.NOTNULL;</td></tr><tr class=""><td class="line">62</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">63</td><td class="hits">9</td><td class="source">                definition[$table.updatedAt] = null;</td></tr><tr class="hit"><td class="line">64</td><td class="hits">9</td><td class="source">                definition[$table.createdAt] = null;</td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">66</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">67</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">68</td><td class="hits">9</td><td class="source">            var cls = __class(name, definition, options);</td></tr><tr class=""><td class="line">69</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">70</td><td class="hits"></td><td class="source">            // first because any field access this, so must be defined before!</td></tr><tr class="hit"><td class="line">71</td><td class="hits">9</td><td class="source">            cls.property(&quot;$data&quot;, $data, {</td></tr><tr class=""><td class="line">72</td><td class="hits"></td><td class="source">                enumerable: false</td></tr><tr class=""><td class="line">73</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">74</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">75</td><td class="hits">9</td><td class="source">            cls.property(&quot;$db&quot;, {}, {</td></tr><tr class=""><td class="line">76</td><td class="hits"></td><td class="source">                enumerable: true</td></tr><tr class=""><td class="line">77</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">78</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">79</td><td class="hits">9</td><td class="source">            cls.property(&quot;$constructor&quot;, true, {</td></tr><tr class=""><td class="line">80</td><td class="hits"></td><td class="source">                enumerable: true,</td></tr><tr class=""><td class="line">81</td><td class="hits"></td><td class="source">                writable: true</td></tr><tr class=""><td class="line">82</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">83</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">84</td><td class="hits">9</td><td class="source">            cls.static(&quot;$field&quot;, function (k, enumerable) {</td></tr><tr class="hit"><td class="line">85</td><td class="hits">42</td><td class="source">                cls.accessor(k, {</td></tr><tr class=""><td class="line">86</td><td class="hits"></td><td class="source">                    enumerable: enumerable === false,</td></tr><tr class=""><td class="line">87</td><td class="hits"></td><td class="source">                    get: function () {</td></tr><tr class="hit"><td class="line">88</td><td class="hits">277</td><td class="source">                        return this.$data[k];</td></tr><tr class=""><td class="line">89</td><td class="hits"></td><td class="source">                    },</td></tr><tr class=""><td class="line">90</td><td class="hits"></td><td class="source">                    set: function (val) {</td></tr><tr class="hit"><td class="line">91</td><td class="hits">180</td><td class="source">                        if (this.$constructor === true) {</td></tr><tr class="hit"><td class="line">92</td><td class="hits">130</td><td class="source">                            this.$db[k] = val;</td></tr><tr class=""><td class="line">93</td><td class="hits"></td><td class="source">                        } else {</td></tr><tr class="hit"><td class="line">94</td><td class="hits">50</td><td class="source">                            this.$dirty = true;</td></tr><tr class=""><td class="line">95</td><td class="hits"></td><td class="source">                        }</td></tr><tr class="hit"><td class="line">96</td><td class="hits">180</td><td class="source">                        this.$data[k] = val;</td></tr><tr class=""><td class="line">97</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">98</td><td class="hits"></td><td class="source">                });</td></tr><tr class=""><td class="line">99</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">100</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">101</td><td class="hits">9</td><td class="source">            object.each($table.structure, function (v, k) {</td></tr><tr class="hit"><td class="line">102</td><td class="hits">39</td><td class="source">                cls.$field(k);</td></tr><tr class=""><td class="line">103</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">104</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">105</td><td class="hits">9</td><td class="source">            __static(cls, &quot;$table&quot;, $table);</td></tr><tr class=""><td class="line">106</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">107</td><td class="hits">9</td><td class="source">            Norm.models[options.tableName] = $table;</td></tr><tr class=""><td class="line">108</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">109</td><td class="hits"></td><td class="source">            // TODO hackish!</td></tr><tr class="hit"><td class="line">110</td><td class="hits">9</td><td class="source">            cls.__dba = dba;</td></tr><tr class="hit"><td class="line">111</td><td class="hits">9</td><td class="source">            cls.prototype.__dba = dba;</td></tr><tr class=""><td class="line">112</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">113</td><td class="hits">9</td><td class="source">            return cls;</td></tr><tr class=""><td class="line">114</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">115</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">116</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">117</td><td class="hits">3</td><td class="source">    Norm.models = {};</td></tr><tr class=""><td class="line">118</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">119</td><td class="hits">3</td><td class="source">    Norm.config_property(&quot;Number&quot;, {</td></tr><tr class=""><td class="line">120</td><td class="hits"></td><td class="source">        $dbtype: &quot;integer&quot;,</td></tr><tr class=""><td class="line">121</td><td class="hits"></td><td class="source">        //common</td></tr><tr class=""><td class="line">122</td><td class="hits"></td><td class="source">        notNull: false,</td></tr><tr class=""><td class="line">123</td><td class="hits"></td><td class="source">        default: null,</td></tr><tr class=""><td class="line">124</td><td class="hits"></td><td class="source">        unique: null,</td></tr><tr class=""><td class="line">125</td><td class="hits"></td><td class="source">        comment: &quot;&quot;,</td></tr><tr class=""><td class="line">126</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">127</td><td class="hits"></td><td class="source">        // number specific</td></tr><tr class=""><td class="line">128</td><td class="hits"></td><td class="source">        length: 11,</td></tr><tr class=""><td class="line">129</td><td class="hits"></td><td class="source">        zerofill: false,</td></tr><tr class=""><td class="line">130</td><td class="hits"></td><td class="source">        unsigned: false</td></tr><tr class=""><td class="line">131</td><td class="hits"></td><td class="source">    }, [&quot;length&quot;, &quot;default&quot;]);</td></tr><tr class=""><td class="line">132</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">133</td><td class="hits">3</td><td class="source">    Norm.config_property(&quot;Decimal&quot;, {</td></tr><tr class=""><td class="line">134</td><td class="hits"></td><td class="source">        $dbtype: &quot;integer&quot;,</td></tr><tr class=""><td class="line">135</td><td class="hits"></td><td class="source">        //common</td></tr><tr class=""><td class="line">136</td><td class="hits"></td><td class="source">        notNull: false,</td></tr><tr class=""><td class="line">137</td><td class="hits"></td><td class="source">        default: null,</td></tr><tr class=""><td class="line">138</td><td class="hits"></td><td class="source">        unique: null,</td></tr><tr class=""><td class="line">139</td><td class="hits"></td><td class="source">        comment: &quot;&quot;,</td></tr><tr class=""><td class="line">140</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">141</td><td class="hits"></td><td class="source">        // number specific</td></tr><tr class=""><td class="line">142</td><td class="hits"></td><td class="source">        length: 8,</td></tr><tr class=""><td class="line">143</td><td class="hits"></td><td class="source">        decimals: 4,</td></tr><tr class=""><td class="line">144</td><td class="hits"></td><td class="source">        zerofill: false,</td></tr><tr class=""><td class="line">145</td><td class="hits"></td><td class="source">        unsigned: false</td></tr><tr class=""><td class="line">146</td><td class="hits"></td><td class="source">    }, [&quot;length&quot;, &quot;decimals&quot;, &quot;default&quot;]);</td></tr><tr class=""><td class="line">147</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">148</td><td class="hits">3</td><td class="source">    Norm.config_property(&quot;String&quot;, {</td></tr><tr class=""><td class="line">149</td><td class="hits"></td><td class="source">        $dbtype: &quot;varchar&quot;,</td></tr><tr class=""><td class="line">150</td><td class="hits"></td><td class="source">        //common</td></tr><tr class=""><td class="line">151</td><td class="hits"></td><td class="source">        notNull: false,</td></tr><tr class=""><td class="line">152</td><td class="hits"></td><td class="source">        default: null,</td></tr><tr class=""><td class="line">153</td><td class="hits"></td><td class="source">        unique: null,</td></tr><tr class=""><td class="line">154</td><td class="hits"></td><td class="source">        comment: &quot;&quot;,</td></tr><tr class=""><td class="line">155</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">156</td><td class="hits"></td><td class="source">        // string specific</td></tr><tr class=""><td class="line">157</td><td class="hits"></td><td class="source">        charset: &quot;utf8&quot;,</td></tr><tr class=""><td class="line">158</td><td class="hits"></td><td class="source">        collation: &quot;utf8_bin&quot;,</td></tr><tr class=""><td class="line">159</td><td class="hits"></td><td class="source">        length: 16</td></tr><tr class=""><td class="line">160</td><td class="hits"></td><td class="source">    }, [&quot;charset&quot;, &quot;collation&quot;, &quot;length&quot;, &quot;default&quot;]);</td></tr><tr class=""><td class="line">161</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">162</td><td class="hits">3</td><td class="source">    Norm.config_property(&quot;TEXT&quot;, {</td></tr><tr class=""><td class="line">163</td><td class="hits"></td><td class="source">        $dbtype: &quot;text&quot;,</td></tr><tr class=""><td class="line">164</td><td class="hits"></td><td class="source">        //common</td></tr><tr class=""><td class="line">165</td><td class="hits"></td><td class="source">        notNull: false,</td></tr><tr class=""><td class="line">166</td><td class="hits"></td><td class="source">        default: null,</td></tr><tr class=""><td class="line">167</td><td class="hits"></td><td class="source">        unique: null,</td></tr><tr class=""><td class="line">168</td><td class="hits"></td><td class="source">        comment: &quot;&quot;,</td></tr><tr class=""><td class="line">169</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">170</td><td class="hits"></td><td class="source">        // string specific</td></tr><tr class=""><td class="line">171</td><td class="hits"></td><td class="source">        charset: &quot;utf8&quot;,</td></tr><tr class=""><td class="line">172</td><td class="hits"></td><td class="source">        collation: &quot;utf8_bin&quot;</td></tr><tr class=""><td class="line">173</td><td class="hits"></td><td class="source">        // length: 16 support for LONG / TINY / MEDIUM ?</td></tr><tr class=""><td class="line">174</td><td class="hits"></td><td class="source">    }, [&quot;charset&quot;, &quot;collation&quot;, &quot;length&quot;, &quot;default&quot;]);</td></tr><tr class=""><td class="line">175</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">176</td><td class="hits">3</td><td class="source">    Norm.config_property(&quot;Date&quot;, {</td></tr><tr class=""><td class="line">177</td><td class="hits"></td><td class="source">        $dbtype: &quot;datetime&quot;,</td></tr><tr class=""><td class="line">178</td><td class="hits"></td><td class="source">        //common</td></tr><tr class=""><td class="line">179</td><td class="hits"></td><td class="source">        notNull: false,</td></tr><tr class=""><td class="line">180</td><td class="hits"></td><td class="source">        default: null,</td></tr><tr class=""><td class="line">181</td><td class="hits"></td><td class="source">        unique: null,</td></tr><tr class=""><td class="line">182</td><td class="hits"></td><td class="source">        comment: &quot;&quot;</td></tr><tr class=""><td class="line">183</td><td class="hits"></td><td class="source">    }, [&quot;default&quot;]);</td></tr><tr class=""><td class="line">184</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">185</td><td class="hits">3</td><td class="source">    Norm.config_property(&quot;ENUM&quot;, {</td></tr><tr class=""><td class="line">186</td><td class="hits"></td><td class="source">        $dbtype: &quot;enum&quot;,</td></tr><tr class=""><td class="line">187</td><td class="hits"></td><td class="source">        //common</td></tr><tr class=""><td class="line">188</td><td class="hits"></td><td class="source">        notNull: false,</td></tr><tr class=""><td class="line">189</td><td class="hits"></td><td class="source">        default: null,</td></tr><tr class=""><td class="line">190</td><td class="hits"></td><td class="source">        unique: null,</td></tr><tr class=""><td class="line">191</td><td class="hits"></td><td class="source">        comment: &quot;&quot;,</td></tr><tr class=""><td class="line">192</td><td class="hits"></td><td class="source">        // enum specific</td></tr><tr class=""><td class="line">193</td><td class="hits"></td><td class="source">        values: [],</td></tr><tr class=""><td class="line">194</td><td class="hits"></td><td class="source">        charset: &quot;utf8&quot;,</td></tr><tr class=""><td class="line">195</td><td class="hits"></td><td class="source">        collation: &quot;utf8_bin&quot;</td></tr><tr class=""><td class="line">196</td><td class="hits"></td><td class="source">    }, [&quot;charset&quot;, &quot;collation&quot;, &quot;values&quot;, &quot;default&quot;]);</td></tr><tr class=""><td class="line">197</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">198</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">199</td><td class="hits">3</td><td class="source">    module.exports = Norm;</td></tr><tr class=""><td class="line">200</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">201</td><td class="hits"></td><td class="source">}());</td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/lib/entity.js">/home/luis/noboxout/noboxout-orm/lib/entity.js</h2>
          <div class="stats high">
            <div class="percentage">87.3%</div>
            <div class="sloc">142</div>
            <div class="hits">124</div>
            <div class="misses">18</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">(function () {</td></tr><tr class="hit"><td class="line">2</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">3</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">4</td><td class="hits">3</td><td class="source">    var object = require(&quot;object-enhancements&quot;),</td></tr><tr class=""><td class="line">5</td><td class="hits"></td><td class="source">        array = require(&quot;array-enhancements&quot;),</td></tr><tr class=""><td class="line">6</td><td class="hits"></td><td class="source">        util = require(&quot;util&quot;),</td></tr><tr class=""><td class="line">7</td><td class="hits"></td><td class="source">        Relation = require(&quot;/home/luis/noboxout/noboxout-orm/lib/./relation.js&quot;),</td></tr><tr class=""><td class="line">8</td><td class="hits"></td><td class="source">        $ = require(&quot;node-class&quot;),</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        __class = $.class;</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">11</td><td class="hits"></td><td class="source">    //$.debug = false;</td></tr><tr class=""><td class="line">12</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">13</td><td class="hits">3</td><td class="source">    function store_related(relations, entity, obj, callback) {</td></tr><tr class="hit"><td class="line">14</td><td class="hits">19</td><td class="source">        var relation,</td></tr><tr class=""><td class="line">15</td><td class="hits"></td><td class="source">            i,</td></tr><tr class=""><td class="line">16</td><td class="hits"></td><td class="source">            max = relations.length,</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source">            retry = function () {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">2</td><td class="source">                store_related(relations, entity, obj, callback);</td></tr><tr class=""><td class="line">19</td><td class="hits"></td><td class="source">            };</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">21</td><td class="hits">19</td><td class="source">        for (i = 0; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">22</td><td class="hits">47</td><td class="source">            relation = relations[i];</td></tr><tr class="hit"><td class="line">23</td><td class="hits">47</td><td class="source">            if (relation.hasForeignKey(entity)) {</td></tr><tr class=""><td class="line">24</td><td class="hits"></td><td class="source">                // true if there is work to be done</td></tr><tr class="hit"><td class="line">25</td><td class="hits">46</td><td class="source">                if (relation.store(entity, obj, retry)) {</td></tr><tr class="hit"><td class="line">26</td><td class="hits">2</td><td class="source">                    return;</td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">28</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">30</td><td class="hits">17</td><td class="source">        callback();</td></tr><tr class=""><td class="line">31</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">32</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">33</td><td class="hits">3</td><td class="source">    function store_entity(dba, entity, callback) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">17</td><td class="source">        var table_data = entity.$self.$table,</td></tr><tr class=""><td class="line">35</td><td class="hits"></td><td class="source">            relations = table_data.relations,</td></tr><tr class=""><td class="line">36</td><td class="hits"></td><td class="source">            obj = object.extract(entity, table_data.fields);</td></tr><tr class=""><td class="line">37</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">38</td><td class="hits">17</td><td class="source">        store_related(relations, entity, obj, function () {</td></tr><tr class=""><td class="line">39</td><td class="hits"></td><td class="source">            // check if obj is valid</td></tr><tr class=""><td class="line">40</td><td class="hits"></td><td class="source">            // any key is a FK ?</td></tr><tr class=""><td class="line">41</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">42</td><td class="hits">17</td><td class="source">            if (table_data.prefix.length) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">17</td><td class="source">                obj = object.prefixKeys(obj, table_data.prefix);</td></tr><tr class=""><td class="line">44</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">45</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">46</td><td class="hits">17</td><td class="source">            if (table_data.timestamps) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">17</td><td class="source">                if (entity[table_data.primaryKey]) {</td></tr><tr class="hit"><td class="line">48</td><td class="hits">7</td><td class="source">                    obj[table_data.prefix + table_data.updatedAt] = new Date();</td></tr><tr class=""><td class="line">49</td><td class="hits"></td><td class="source">                } else {</td></tr><tr class="hit"><td class="line">50</td><td class="hits">10</td><td class="source">                    obj[table_data.prefix + table_data.createdAt] = new Date();</td></tr><tr class=""><td class="line">51</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">52</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">53</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">54</td><td class="hits"></td><td class="source">            /*</td></tr><tr class=""><td class="line">55</td><td class="hits"></td><td class="source">            if (entity.main_tag) {</td></tr><tr class=""><td class="line">56</td><td class="hits"></td><td class="source">                console.log(obj);</td></tr><tr class=""><td class="line">57</td><td class="hits"></td><td class="source">                process.exit();</td></tr><tr class=""><td class="line">58</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">59</td><td class="hits"></td><td class="source">            */</td></tr><tr class=""><td class="line">60</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">61</td><td class="hits">17</td><td class="source">            dba.store(table_data.tableName, table_data.prefix + table_data.primaryKey, obj, function (err, id, result) {</td></tr><tr class="hit"><td class="line">62</td><td class="hits">17</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">63</td><td class="hits">0</td><td class="source">                    throw err;</td></tr><tr class=""><td class="line">64</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">66</td><td class="hits">17</td><td class="source">                if (id) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">17</td><td class="source">                    entity[table_data.primaryKey] = id;</td></tr><tr class=""><td class="line">68</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">69</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">70</td><td class="hits">17</td><td class="source">                entity.emit(&quot;saved&quot;);</td></tr><tr class=""><td class="line">71</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">72</td><td class="hits">17</td><td class="source">                callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">73</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">74</td><td class="hits"></td><td class="source">        });</td></tr><tr class=""><td class="line">75</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">76</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">77</td><td class="hits">3</td><td class="source">    function export_type(prefix, field_name, options, pk) {</td></tr><tr class="hit"><td class="line">78</td><td class="hits">48</td><td class="source">        var field = &quot;    `&quot; + prefix + field_name + &quot;` &quot; + options.$dbtype.toUpperCase();</td></tr><tr class=""><td class="line">79</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">80</td><td class="hits">48</td><td class="source">        switch (options.$dbtype) {</td></tr><tr class=""><td class="line">81</td><td class="hits"></td><td class="source">            case &quot;integer&quot;:</td></tr><tr class="hit"><td class="line">82</td><td class="hits">18</td><td class="source">                field += &quot;(&quot; + options.length + &quot;)&quot;;</td></tr><tr class="hit"><td class="line">83</td><td class="hits">18</td><td class="source">                if (options.zerofill) {</td></tr><tr class="hit"><td class="line">84</td><td class="hits">6</td><td class="source">                    field += &quot; ZEROFILL&quot;;</td></tr><tr class=""><td class="line">85</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">86</td><td class="hits">18</td><td class="source">                if (options.unsigned) {</td></tr><tr class="hit"><td class="line">87</td><td class="hits">18</td><td class="source">                    field += &quot; UNSIGNED&quot;;</td></tr><tr class=""><td class="line">88</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">89</td><td class="hits">18</td><td class="source">                break;</td></tr><tr class=""><td class="line">90</td><td class="hits"></td><td class="source">            case &quot;varchar&quot;:</td></tr><tr class="hit"><td class="line">91</td><td class="hits">9</td><td class="source">                field += &quot;(&quot; + options.length + &quot;)&quot;;</td></tr><tr class="hit"><td class="line">92</td><td class="hits">9</td><td class="source">                break;</td></tr><tr class=""><td class="line">93</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">94</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">95</td><td class="hits">48</td><td class="source">        if (pk === field_name) {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">9</td><td class="source">            field += &quot; AUTO_INCREMENT&quot;;</td></tr><tr class=""><td class="line">97</td><td class="hits"></td><td class="source">        }</td></tr><tr class="hit"><td class="line">98</td><td class="hits">48</td><td class="source">        if (options.default) {</td></tr><tr class="miss"><td class="line">99</td><td class="hits">0</td><td class="source">            field += &quot; DEFAULT &quot; + options.default;</td></tr><tr class=""><td class="line">100</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">101</td><td class="hits"></td><td class="source">        /*</td></tr><tr class=""><td class="line">102</td><td class="hits"></td><td class="source">        if (options.charset) {</td></tr><tr class=""><td class="line">103</td><td class="hits"></td><td class="source">            field += &quot; CHARACTER SET &quot; + options.charset;</td></tr><tr class=""><td class="line">104</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">105</td><td class="hits"></td><td class="source">        if (options.collation) {</td></tr><tr class=""><td class="line">106</td><td class="hits"></td><td class="source">            field += &quot; COLLATE &quot; + options.collation;</td></tr><tr class=""><td class="line">107</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">108</td><td class="hits"></td><td class="source">        */</td></tr><tr class=""><td class="line">109</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">110</td><td class="hits">48</td><td class="source">        return field;</td></tr><tr class=""><td class="line">111</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">112</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">113</td><td class="hits">3</td><td class="source">    __class(&quot;Norm/Entity&quot;, {</td></tr><tr class=""><td class="line">114</td><td class="hits"></td><td class="source">        extends: [&quot;Events&quot;],</td></tr><tr class=""><td class="line">115</td><td class="hits"></td><td class="source">        initialize: function () {</td></tr><tr class=""><td class="line">116</td><td class="hits"></td><td class="source">            // set to false because</td></tr><tr class="hit"><td class="line">117</td><td class="hits">44</td><td class="source">            this.__parent();</td></tr><tr class="hit"><td class="line">118</td><td class="hits">44</td><td class="source">            this.$dirty = false;</td></tr><tr class="hit"><td class="line">119</td><td class="hits">44</td><td class="source">            this.$constructor = false;</td></tr><tr class=""><td class="line">120</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">121</td><td class="hits"></td><td class="source">        $changes: function () {</td></tr><tr class="hit"><td class="line">122</td><td class="hits">6</td><td class="source">            return object.diff(this.$data, this.$db);</td></tr><tr class=""><td class="line">123</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">124</td><td class="hits"></td><td class="source">        //inspect: function() {</td></tr><tr class=""><td class="line">125</td><td class="hits"></td><td class="source">        //    return object.extract(this, this.$self.properties);</td></tr><tr class=""><td class="line">126</td><td class="hits"></td><td class="source">        //},</td></tr><tr class=""><td class="line">127</td><td class="hits"></td><td class="source">        &quot;static $from&quot;: function (result, nested, root) {</td></tr><tr class="hit"><td class="line">128</td><td class="hits">67</td><td class="source">            nested = nested || false;</td></tr><tr class="hit"><td class="line">129</td><td class="hits">67</td><td class="source">            root = root || false;</td></tr><tr class=""><td class="line">130</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">131</td><td class="hits">67</td><td class="source">            if (!nested) {</td></tr><tr class="hit"><td class="line">132</td><td class="hits">52</td><td class="source">                log(result);</td></tr><tr class="hit"><td class="line">133</td><td class="hits">52</td><td class="source">                if (!result || result[this.$table.prefix + this.$table.primaryKey] === null) {</td></tr><tr class="hit"><td class="line">134</td><td class="hits">30</td><td class="source">                    return null;</td></tr><tr class=""><td class="line">135</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">136</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">137</td><td class="hits">22</td><td class="source">                if (this.$table.prefix.length) {</td></tr><tr class="hit"><td class="line">138</td><td class="hits">22</td><td class="source">                    return new this(object.remPrefixKeys(result, this.$table.prefix));</td></tr><tr class=""><td class="line">139</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">140</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">141</td><td class="hits">0</td><td class="source">                return new this(result);</td></tr><tr class=""><td class="line">142</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">143</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">144</td><td class="hits">15</td><td class="source">            var t = this.$table,</td></tr><tr class=""><td class="line">145</td><td class="hits"></td><td class="source">                entity = this.$from(result[root ? &quot;root&quot; : t.tableName]),</td></tr><tr class=""><td class="line">146</td><td class="hits"></td><td class="source">                i,</td></tr><tr class=""><td class="line">147</td><td class="hits"></td><td class="source">                max,</td></tr><tr class=""><td class="line">148</td><td class="hits"></td><td class="source">                rel,</td></tr><tr class=""><td class="line">149</td><td class="hits"></td><td class="source">                subentity;</td></tr><tr class=""><td class="line">150</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">151</td><td class="hits">15</td><td class="source">            for (i = 0, max = t.relations.length; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">36</td><td class="source">                rel = t.relations[i];</td></tr><tr class=""><td class="line">153</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">154</td><td class="hits">36</td><td class="source">                switch (rel.type) {</td></tr><tr class=""><td class="line">155</td><td class="hits"></td><td class="source">                case &quot;OneToMany&quot;:</td></tr><tr class=""><td class="line">156</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">157</td><td class="hits">11</td><td class="source">                    log(entity[rel.property]);</td></tr><tr class=""><td class="line">158</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">159</td><td class="hits">11</td><td class="source">                    if (Array.isArray(result[rel.property])) {</td></tr><tr class="hit"><td class="line">160</td><td class="hits">1</td><td class="source">                        for (i = 0, max = result[rel.property].length; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">2</td><td class="source">                            subentity = rel.reference.$from(result[rel.property][i]);</td></tr><tr class="hit"><td class="line">162</td><td class="hits">2</td><td class="source">                            if (subentity) {</td></tr><tr class="hit"><td class="line">163</td><td class="hits">2</td><td class="source">                                entity[rel.property].push(subentity);</td></tr><tr class=""><td class="line">164</td><td class="hits"></td><td class="source">                            }</td></tr><tr class=""><td class="line">165</td><td class="hits"></td><td class="source">                        }</td></tr><tr class=""><td class="line">166</td><td class="hits"></td><td class="source">                    } else {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">10</td><td class="source">                        subentity = rel.reference.$from(result[rel.property]);</td></tr><tr class="hit"><td class="line">168</td><td class="hits">10</td><td class="source">                        if (subentity) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">1</td><td class="source">                            entity[rel.property].push(subentity);</td></tr><tr class=""><td class="line">170</td><td class="hits"></td><td class="source">                        }</td></tr><tr class=""><td class="line">171</td><td class="hits"></td><td class="source">                    }</td></tr><tr class="hit"><td class="line">172</td><td class="hits">11</td><td class="source">                    break;</td></tr><tr class=""><td class="line">173</td><td class="hits"></td><td class="source">                case &quot;OneToOne&quot;:</td></tr><tr class="hit"><td class="line">174</td><td class="hits">25</td><td class="source">                    if (rel.isRoot(this)) {</td></tr><tr class="hit"><td class="line">175</td><td class="hits">22</td><td class="source">                        if (Array.isArray(result[rel.property])) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">2</td><td class="source">                            result[rel.property] = result[rel.property][0];</td></tr><tr class=""><td class="line">177</td><td class="hits"></td><td class="source">                        }</td></tr><tr class="hit"><td class="line">178</td><td class="hits">22</td><td class="source">                        entity[rel.property] =  rel.reference.$from(result[rel.property]);</td></tr><tr class=""><td class="line">179</td><td class="hits"></td><td class="source">                    } else {</td></tr><tr class="hit"><td class="line">180</td><td class="hits">3</td><td class="source">                        if (Array.isArray(result[rel.property])) {</td></tr><tr class="miss"><td class="line">181</td><td class="hits">0</td><td class="source">                            result[rel.refProperty] = result[rel.refProperty][0];</td></tr><tr class=""><td class="line">182</td><td class="hits"></td><td class="source">                        }</td></tr><tr class="hit"><td class="line">183</td><td class="hits">3</td><td class="source">                        entity[rel.refProperty] =  rel.root.$from(result[rel.refProperty]);</td></tr><tr class=""><td class="line">184</td><td class="hits"></td><td class="source">                    }</td></tr><tr class="hit"><td class="line">185</td><td class="hits">25</td><td class="source">                    break;</td></tr><tr class=""><td class="line">186</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">187</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">188</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">189</td><td class="hits">15</td><td class="source">            return entity;</td></tr><tr class=""><td class="line">190</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">191</td><td class="hits"></td><td class="source">        &quot;static $get&quot;: function (pkval, options, callback) {</td></tr><tr class="hit"><td class="line">192</td><td class="hits">15</td><td class="source">            if (callback === undefined) {</td></tr><tr class="hit"><td class="line">193</td><td class="hits">15</td><td class="source">                callback = options;</td></tr><tr class="hit"><td class="line">194</td><td class="hits">15</td><td class="source">                options = {};</td></tr><tr class=""><td class="line">195</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">196</td><td class="hits">15</td><td class="source">            options = options || {};</td></tr><tr class="hit"><td class="line">197</td><td class="hits">15</td><td class="source">            options.eager = options.eager || 1;</td></tr><tr class=""><td class="line">198</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">199</td><td class="hits">15</td><td class="source">            var t = this.$table,</td></tr><tr class=""><td class="line">200</td><td class="hits"></td><td class="source">                sql = this.__dba.mysql.selectByPK(t, this, options.eager);</td></tr><tr class=""><td class="line">201</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">202</td><td class="hits">15</td><td class="source">            this.__dba.query({sql: sql, nestTables: true}, [pkval], function (err, result) {</td></tr><tr class="hit"><td class="line">203</td><td class="hits">15</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">204</td><td class="hits">0</td><td class="source">                    throw err;</td></tr><tr class=""><td class="line">205</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">206</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">207</td><td class="hits">15</td><td class="source">                var i,</td></tr><tr class=""><td class="line">208</td><td class="hits"></td><td class="source">                    max = result.length,</td></tr><tr class=""><td class="line">209</td><td class="hits"></td><td class="source">                    keys,</td></tr><tr class=""><td class="line">210</td><td class="hits"></td><td class="source">                    j,</td></tr><tr class=""><td class="line">211</td><td class="hits"></td><td class="source">                    jmax,</td></tr><tr class=""><td class="line">212</td><td class="hits"></td><td class="source">                    k,</td></tr><tr class=""><td class="line">213</td><td class="hits"></td><td class="source">                    result_ex,</td></tr><tr class=""><td class="line">214</td><td class="hits"></td><td class="source">                    entity;</td></tr><tr class=""><td class="line">215</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">216</td><td class="hits"></td><td class="source">                // @todo _typeCast is leaking!</td></tr><tr class=""><td class="line">217</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">218</td><td class="hits">15</td><td class="source">                if (max === 1) {</td></tr><tr class="hit"><td class="line">219</td><td class="hits">14</td><td class="source">                    log(&quot;Entity::$get&quot;, result);</td></tr><tr class="hit"><td class="line">220</td><td class="hits">14</td><td class="source">                    result = result[0];</td></tr><tr class="hit"><td class="line">221</td><td class="hits">14</td><td class="source">                    entity = this.$from(result, true/*nested*/, true/*root*/); // jshint ignore:line</td></tr><tr class="hit"><td class="line">222</td><td class="hits">1</td><td class="source">                } else if (max &gt; 1) {</td></tr><tr class="hit"><td class="line">223</td><td class="hits">1</td><td class="source">                    result_ex = {</td></tr><tr class=""><td class="line">224</td><td class="hits"></td><td class="source">                        root: result[0].root, // root wont change</td></tr><tr class=""><td class="line">225</td><td class="hits"></td><td class="source">                    };</td></tr><tr class="hit"><td class="line">226</td><td class="hits">1</td><td class="source">                    keys = Object.keys(result[0]);</td></tr><tr class="hit"><td class="line">227</td><td class="hits">1</td><td class="source">                    keys.splice(keys.indexOf(&quot;root&quot;), 1);</td></tr><tr class=""><td class="line">228</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">229</td><td class="hits">1</td><td class="source">                    jmax = keys.length;</td></tr><tr class="hit"><td class="line">230</td><td class="hits">1</td><td class="source">                    for (i = 0; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">231</td><td class="hits">2</td><td class="source">                        for (j = 0; j &lt; jmax; ++j) {</td></tr><tr class="hit"><td class="line">232</td><td class="hits">6</td><td class="source">                            k = keys[j];</td></tr><tr class="hit"><td class="line">233</td><td class="hits">6</td><td class="source">                            result_ex[k] = result_ex[k] || [];</td></tr><tr class=""><td class="line">234</td><td class="hits"></td><td class="source">                            // do not add nulls</td></tr><tr class=""><td class="line">235</td><td class="hits"></td><td class="source">                            //var check = Array.unique(object.values(result[i][k]));</td></tr><tr class=""><td class="line">236</td><td class="hits"></td><td class="source">                            //if (!(check.length === 1 &amp;&amp; check[0] === null)) {</td></tr><tr class="hit"><td class="line">237</td><td class="hits">6</td><td class="source">                                result_ex[k].push(result[i][k]);</td></tr><tr class=""><td class="line">238</td><td class="hits"></td><td class="source">                            //}</td></tr><tr class=""><td class="line">239</td><td class="hits"></td><td class="source">                        }</td></tr><tr class=""><td class="line">240</td><td class="hits"></td><td class="source">                    }</td></tr><tr class="hit"><td class="line">241</td><td class="hits">1</td><td class="source">                    for (j = 0; j &lt; jmax; ++j) {</td></tr><tr class="hit"><td class="line">242</td><td class="hits">3</td><td class="source">                        result_ex[k] = array.unique(result_ex[k]);</td></tr><tr class=""><td class="line">243</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">244</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">245</td><td class="hits">1</td><td class="source">                    log(&quot;Entity::$get&quot;, result_ex);</td></tr><tr class=""><td class="line">246</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">247</td><td class="hits">1</td><td class="source">                    entity = this.$from(result_ex, true/*nested*/, true/*root*/); // jshint ignore:line</td></tr><tr class=""><td class="line">248</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">249</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">250</td><td class="hits">15</td><td class="source">                callback &amp;&amp; callback(err, result ? entity : result, result);</td></tr><tr class=""><td class="line">251</td><td class="hits"></td><td class="source">            }.bind(this));</td></tr><tr class=""><td class="line">252</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">253</td><td class="hits"></td><td class="source">        // internal</td></tr><tr class=""><td class="line">254</td><td class="hits"></td><td class="source">        &quot;static $createTable&quot;: function () {</td></tr><tr class="hit"><td class="line">255</td><td class="hits">9</td><td class="source">            var table_data = this.$table,</td></tr><tr class=""><td class="line">256</td><td class="hits"></td><td class="source">                fields = table_data.fields,</td></tr><tr class=""><td class="line">257</td><td class="hits"></td><td class="source">                create,</td></tr><tr class=""><td class="line">258</td><td class="hits"></td><td class="source">                alters = [],</td></tr><tr class=""><td class="line">259</td><td class="hits"></td><td class="source">                i,</td></tr><tr class=""><td class="line">260</td><td class="hits"></td><td class="source">                max,</td></tr><tr class=""><td class="line">261</td><td class="hits"></td><td class="source">                structure,</td></tr><tr class=""><td class="line">262</td><td class="hits"></td><td class="source">                sqlf = [],</td></tr><tr class=""><td class="line">263</td><td class="hits"></td><td class="source">                sqlk = [],</td></tr><tr class=""><td class="line">264</td><td class="hits"></td><td class="source">                rel,</td></tr><tr class=""><td class="line">265</td><td class="hits"></td><td class="source">                tableName = table_data.tableName,</td></tr><tr class=""><td class="line">266</td><td class="hits"></td><td class="source">                prefix = table_data.prefix;</td></tr><tr class=""><td class="line">267</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">268</td><td class="hits">9</td><td class="source">            create = &quot;CREATE TABLE `&quot; + tableName + &quot;` (\n&quot;;</td></tr><tr class="hit"><td class="line">269</td><td class="hits">9</td><td class="source">            for (i = 0, max = fields.length; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">270</td><td class="hits">48</td><td class="source">                structure = table_data.structure[fields[i]];</td></tr><tr class=""><td class="line">271</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">272</td><td class="hits">48</td><td class="source">                sqlf.push(export_type(prefix, fields[i], structure, table_data.primaryKey));</td></tr><tr class=""><td class="line">273</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">274</td><td class="hits"></td><td class="source">                //fields[i]</td></tr><tr class=""><td class="line">275</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">276</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">277</td><td class="hits">9</td><td class="source">            sqlk.push(&quot;    PRIMARY KEY ( &quot; + prefix + table_data.primaryKey + &quot; )&quot;);</td></tr><tr class=""><td class="line">278</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">279</td><td class="hits"></td><td class="source">            //table_data.fields</td></tr><tr class=""><td class="line">280</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">281</td><td class="hits"></td><td class="source">            //alters!</td></tr><tr class=""><td class="line">282</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">283</td><td class="hits"></td><td class="source">            // TODO DO DO DO!</td></tr><tr class="hit"><td class="line">284</td><td class="hits">9</td><td class="source">            for (i = 0, max = table_data.relations.length; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">285</td><td class="hits">12</td><td class="source">                rel = table_data.relations[i];</td></tr><tr class="hit"><td class="line">286</td><td class="hits">12</td><td class="source">                rel.creation(this, sqlk, alters);</td></tr><tr class=""><td class="line">287</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">288</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">289</td><td class="hits">9</td><td class="source">            array.combine(sqlf, sqlk);</td></tr><tr class=""><td class="line">290</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">291</td><td class="hits">9</td><td class="source">            create = create + sqlf.join(&quot;,\n&quot;) + &quot;\n) ENGINE = InnoDB;\n&quot;;</td></tr><tr class=""><td class="line">292</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">293</td><td class="hits">9</td><td class="source">            return [create, alters];</td></tr><tr class=""><td class="line">294</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">295</td><td class="hits"></td><td class="source">        // internal</td></tr><tr class=""><td class="line">296</td><td class="hits"></td><td class="source">        &quot;static $$addRelation&quot;: function (relation) {</td></tr><tr class="miss"><td class="line">297</td><td class="hits">0</td><td class="source">            if (relation.owner === this) {</td></tr><tr class="miss"><td class="line">298</td><td class="hits">0</td><td class="source">                this.$table.relations.push(relation);</td></tr><tr class=""><td class="line">299</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">300</td><td class="hits"></td><td class="source">                // where will be stored</td></tr><tr class="miss"><td class="line">301</td><td class="hits">0</td><td class="source">                if (&quot;OneToOne&quot; === relation.type) {</td></tr><tr class="miss"><td class="line">302</td><td class="hits">0</td><td class="source">                    this.property(relation.property, null);</td></tr><tr class=""><td class="line">303</td><td class="hits"></td><td class="source">                } else {</td></tr><tr class="miss"><td class="line">304</td><td class="hits">0</td><td class="source">                    this.property(relation.property, []);</td></tr><tr class=""><td class="line">305</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">306</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">307</td><td class="hits"></td><td class="source">                // fk in database</td></tr><tr class="miss"><td class="line">308</td><td class="hits">0</td><td class="source">                this.$table.structure[relation.fk] = relation.target.$table.structure[relation.refColumn];</td></tr><tr class="miss"><td class="line">309</td><td class="hits">0</td><td class="source">                this.$table.fields.push(relation.fk);</td></tr><tr class="miss"><td class="line">310</td><td class="hits">0</td><td class="source">            } else if (relation.target === this) {</td></tr><tr class="miss"><td class="line">311</td><td class="hits">0</td><td class="source">                if (relation.refProperty) { // bi-directional</td></tr><tr class="miss"><td class="line">312</td><td class="hits">0</td><td class="source">                    this.$table.relations.push(relation);</td></tr><tr class=""><td class="line">313</td><td class="hits"></td><td class="source">                    // where will be stored</td></tr><tr class="miss"><td class="line">314</td><td class="hits">0</td><td class="source">                    if (&quot;OneToOne&quot; === relation.type) {</td></tr><tr class="miss"><td class="line">315</td><td class="hits">0</td><td class="source">                        relation.target.property(relation.refProperty, null);</td></tr><tr class=""><td class="line">316</td><td class="hits"></td><td class="source">                    } else {</td></tr><tr class="miss"><td class="line">317</td><td class="hits">0</td><td class="source">                        relation.target.property(relation.refProperty, []);</td></tr><tr class=""><td class="line">318</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">319</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">320</td><td class="hits"></td><td class="source">                    //there is no field in database</td></tr><tr class=""><td class="line">321</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">322</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">323</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">324</td><td class="hits"></td><td class="source">        &quot;static $hasOne&quot;: function (target_entity, options) {</td></tr><tr class=""><td class="line">325</td><td class="hits"></td><td class="source">            // edge cases</td></tr><tr class=""><td class="line">326</td><td class="hits"></td><td class="source">            // relation to myself, and canBeNull is true</td></tr><tr class=""><td class="line">327</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">328</td><td class="hits">6</td><td class="source">            Relation.OneToOne(this, target_entity, options);</td></tr><tr class="hit"><td class="line">329</td><td class="hits">6</td><td class="source">            return this;</td></tr><tr class=""><td class="line">330</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">331</td><td class="hits"></td><td class="source">        &quot;static $hasMany&quot;: function (target_entity, options) {</td></tr><tr class="hit"><td class="line">332</td><td class="hits">3</td><td class="source">            Relation.OneToMany(this, target_entity, options);</td></tr><tr class="hit"><td class="line">333</td><td class="hits">3</td><td class="source">            return this;</td></tr><tr class=""><td class="line">334</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">335</td><td class="hits"></td><td class="source">        $pk: function () {</td></tr><tr class="hit"><td class="line">336</td><td class="hits">5</td><td class="source">            var t = this.$self.$table;</td></tr><tr class="hit"><td class="line">337</td><td class="hits">5</td><td class="source">            return this[t.primaryKey];</td></tr><tr class=""><td class="line">338</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">339</td><td class="hits"></td><td class="source">        $store: function (callback) {</td></tr><tr class="hit"><td class="line">340</td><td class="hits">17</td><td class="source">            store_entity(this.__dba, this, callback);</td></tr><tr class=""><td class="line">341</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">342</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">343</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">344</td><td class="hits"></td><td class="source">}());</td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/lib/relation.js">/home/luis/noboxout/noboxout-orm/lib/relation.js</h2>
          <div class="stats high">
            <div class="percentage">90.5%</div>
            <div class="sloc">147</div>
            <div class="hits">133</div>
            <div class="misses">14</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">(function () {</td></tr><tr class="hit"><td class="line">2</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">3</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">4</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">5</td><td class="hits">3</td><td class="source">    var $ = require(&quot;node-class&quot;),</td></tr><tr class=""><td class="line">6</td><td class="hits"></td><td class="source">        __class = $.class,</td></tr><tr class=""><td class="line">7</td><td class="hits"></td><td class="source">        count = 0,</td></tr><tr class=""><td class="line">8</td><td class="hits"></td><td class="source">        Relation,</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        ONE_TO_ONE = &quot;OneToOne&quot;,</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source">        MANY_TO_ONE = &quot;ManyToOne&quot;,</td></tr><tr class=""><td class="line">11</td><td class="hits"></td><td class="source">        ONE_TO_MANY = &quot;OneToMany&quot;,</td></tr><tr class=""><td class="line">12</td><td class="hits"></td><td class="source">        CC_DEFAULT_REGEX = /[-_]+(.)?/g;</td></tr><tr class=""><td class="line">13</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">14</td><td class="hits">3</td><td class="source">    function toUpper(match, group1) {</td></tr><tr class="hit"><td class="line">15</td><td class="hits">6</td><td class="source">        return group1 ? group1.toUpperCase() : &quot;&quot;;</td></tr><tr class=""><td class="line">16</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">18</td><td class="hits">3</td><td class="source">    function camelCase(str, delimiters) {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">6</td><td class="source">        return str.replace(delimiters ? new RegExp(&quot;[&quot; + delimiters + &quot;]+(.)&quot;, &quot;g&quot;) : CC_DEFAULT_REGEX, toUpper);</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">21</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">22</td><td class="hits">3</td><td class="source">    Relation = __class(&quot;norm/relation&quot;, {</td></tr><tr class=""><td class="line">23</td><td class="hits"></td><td class="source">        id: null,</td></tr><tr class=""><td class="line">24</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">25</td><td class="hits"></td><td class="source">        canBeNull: false,</td></tr><tr class=""><td class="line">26</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source">        root: null,</td></tr><tr class=""><td class="line">28</td><td class="hits"></td><td class="source">        property: null,</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">        foreignKey: null,</td></tr><tr class=""><td class="line">30</td><td class="hits"></td><td class="source">        eager: false,</td></tr><tr class=""><td class="line">31</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">32</td><td class="hits"></td><td class="source">        reference: null,</td></tr><tr class=""><td class="line">33</td><td class="hits"></td><td class="source">        refProperty: null,</td></tr><tr class=""><td class="line">34</td><td class="hits"></td><td class="source">        refColumn: null,</td></tr><tr class=""><td class="line">35</td><td class="hits"></td><td class="source">        refEager: false,</td></tr><tr class=""><td class="line">36</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">37</td><td class="hits"></td><td class="source">        unique: true, // OneOnOne</td></tr><tr class=""><td class="line">38</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">39</td><td class="hits"></td><td class="source">        type: &quot;OneToOne&quot;,</td></tr><tr class=""><td class="line">40</td><td class="hits"></td><td class="source">        initialize: function () {</td></tr><tr class="hit"><td class="line">41</td><td class="hits">9</td><td class="source">            this.id = ++count;</td></tr><tr class=""><td class="line">42</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">43</td><td class="hits"></td><td class="source">        isBidirectional : function () {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">12</td><td class="source">            return this.refProperty !== null;</td></tr><tr class=""><td class="line">45</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">46</td><td class="hits"></td><td class="source">        isRoot: function (entity) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">34</td><td class="source">            return this.root.$class === entity.$class;</td></tr><tr class=""><td class="line">48</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">49</td><td class="hits"></td><td class="source">        isReference: function (entity) {</td></tr><tr class="miss"><td class="line">50</td><td class="hits">0</td><td class="source">            return this.reference.$class === entity.$class;</td></tr><tr class=""><td class="line">51</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">52</td><td class="hits"></td><td class="source">        hasForeignKey: function (entity) {</td></tr><tr class="hit"><td class="line">53</td><td class="hits">47</td><td class="source">            var owner_side;</td></tr><tr class="hit"><td class="line">54</td><td class="hits">47</td><td class="source">            switch (this.type) {</td></tr><tr class=""><td class="line">55</td><td class="hits"></td><td class="source">            case ONE_TO_ONE:</td></tr><tr class=""><td class="line">56</td><td class="hits"></td><td class="source">            case MANY_TO_ONE:</td></tr><tr class="hit"><td class="line">57</td><td class="hits">32</td><td class="source">                owner_side = this.root;</td></tr><tr class="hit"><td class="line">58</td><td class="hits">32</td><td class="source">                break;</td></tr><tr class=""><td class="line">59</td><td class="hits"></td><td class="source">            case ONE_TO_MANY:</td></tr><tr class="hit"><td class="line">60</td><td class="hits">15</td><td class="source">                owner_side = this.reference;</td></tr><tr class="hit"><td class="line">61</td><td class="hits">15</td><td class="source">                break;</td></tr><tr class=""><td class="line">62</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">63</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">64</td><td class="hits">47</td><td class="source">            return owner_side.$class === entity.$class;</td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">66</td><td class="hits"></td><td class="source">        apply: function (query, root) {</td></tr><tr class="hit"><td class="line">67</td><td class="hits">36</td><td class="source">            switch(this.type) {</td></tr><tr class=""><td class="line">68</td><td class="hits"></td><td class="source">            case ONE_TO_ONE:</td></tr><tr class=""><td class="line">69</td><td class="hits"></td><td class="source">            case MANY_TO_ONE:</td></tr><tr class="hit"><td class="line">70</td><td class="hits">25</td><td class="source">                if (this.root === root) {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">22</td><td class="source">                    return this.applyRight(query);</td></tr><tr class=""><td class="line">72</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">73</td><td class="hits">3</td><td class="source">                return this.applyLeft(query);</td></tr><tr class=""><td class="line">74</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">75</td><td class="hits"></td><td class="source">            case ONE_TO_MANY:</td></tr><tr class="hit"><td class="line">76</td><td class="hits">11</td><td class="source">                return this.applyRightReverse(query);</td></tr><tr class=""><td class="line">77</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">78</td><td class="hits"></td><td class="source">            };</td></tr><tr class=""><td class="line">79</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">80</td><td class="hits"></td><td class="source">        applyRightReverse: function (query) {</td></tr><tr class="hit"><td class="line">81</td><td class="hits">11</td><td class="source">            var r_tbl = this.root.$table,</td></tr><tr class=""><td class="line">82</td><td class="hits"></td><td class="source">                t_tbl = this.reference.$table,</td></tr><tr class=""><td class="line">83</td><td class="hits"></td><td class="source">                alias = this.property,</td></tr><tr class=""><td class="line">84</td><td class="hits"></td><td class="source">                left = [query.getRootAlias(), t_tbl.prefix + this.refColumn],</td></tr><tr class=""><td class="line">85</td><td class="hits"></td><td class="source">                right = [alias, r_tbl.prefix + this.foreignKey],</td></tr><tr class=""><td class="line">86</td><td class="hits"></td><td class="source">                fn;</td></tr><tr class=""><td class="line">87</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">88</td><td class="hits">11</td><td class="source">            if (this.eager) {</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">                query.select(alias + &quot;.*&quot;, true);</td></tr><tr class=""><td class="line">90</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">91</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">92</td><td class="hits">11</td><td class="source">            fn = this.canBeNull ? &quot;joinLeft&quot; : &quot;joinInner&quot;;</td></tr><tr class=""><td class="line">93</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">94</td><td class="hits">11</td><td class="source">            return query[fn](t_tbl.tableName, alias, left, right);</td></tr><tr class=""><td class="line">95</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">96</td><td class="hits"></td><td class="source">        applyRight: function (query) {</td></tr><tr class="hit"><td class="line">97</td><td class="hits">22</td><td class="source">            var r_tbl = this.root.$table,</td></tr><tr class=""><td class="line">98</td><td class="hits"></td><td class="source">                t_tbl = this.reference.$table,</td></tr><tr class=""><td class="line">99</td><td class="hits"></td><td class="source">                alias = this.property,</td></tr><tr class=""><td class="line">100</td><td class="hits"></td><td class="source">                left = [query.getRootAlias(), r_tbl.prefix + this.foreignKey],</td></tr><tr class=""><td class="line">101</td><td class="hits"></td><td class="source">                right = [alias, t_tbl.prefix + this.refColumn],</td></tr><tr class=""><td class="line">102</td><td class="hits"></td><td class="source">                fn;</td></tr><tr class=""><td class="line">103</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">104</td><td class="hits">22</td><td class="source">            if (this.eager) {</td></tr><tr class="miss"><td class="line">105</td><td class="hits">0</td><td class="source">                query.select(alias + &quot;.*&quot;, true);</td></tr><tr class=""><td class="line">106</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">107</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">108</td><td class="hits">22</td><td class="source">            fn = this.canBeNull ? &quot;joinLeft&quot; : &quot;joinInner&quot;;</td></tr><tr class=""><td class="line">109</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">110</td><td class="hits">22</td><td class="source">            return query[fn](t_tbl.tableName, alias, left, right);</td></tr><tr class=""><td class="line">111</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">112</td><td class="hits"></td><td class="source">        applyLeft: function (query) {</td></tr><tr class="hit"><td class="line">113</td><td class="hits">3</td><td class="source">            if (!this.isBidirectional()) {</td></tr><tr class="miss"><td class="line">114</td><td class="hits">0</td><td class="source">                throw new Error(&quot;relation is not bidirectional, did you forget refProperty ?&quot;);</td></tr><tr class=""><td class="line">115</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">116</td><td class="hits">3</td><td class="source">            var r_tbl = this.root.$table,</td></tr><tr class=""><td class="line">117</td><td class="hits"></td><td class="source">                t_tbl = this.reference.$table,</td></tr><tr class=""><td class="line">118</td><td class="hits"></td><td class="source">                alias = this.refProperty,</td></tr><tr class=""><td class="line">119</td><td class="hits"></td><td class="source">                left = [query.getRootAlias(), t_tbl.prefix + this.refColumn],</td></tr><tr class=""><td class="line">120</td><td class="hits"></td><td class="source">                right = [alias, r_tbl.prefix + this.foreignKey],</td></tr><tr class=""><td class="line">121</td><td class="hits"></td><td class="source">                fn;</td></tr><tr class=""><td class="line">122</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">123</td><td class="hits">3</td><td class="source">            if (this.eager) {</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">                query.select(alias + &quot;.*&quot;, true);</td></tr><tr class=""><td class="line">125</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">126</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">127</td><td class="hits">3</td><td class="source">            fn = this.canBeNull ? &quot;joinLeft&quot; : &quot;joinInner&quot;;</td></tr><tr class=""><td class="line">128</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">129</td><td class="hits">3</td><td class="source">            return query[fn](r_tbl.tableName, alias, left, right);</td></tr><tr class=""><td class="line">130</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">131</td><td class="hits"></td><td class="source">        storeOneToOne: function (entity, obj, callback, retried) {</td></tr><tr class="hit"><td class="line">132</td><td class="hits">32</td><td class="source">            var subentity,</td></tr><tr class="hit"><td class="line">133</td><td class="hits">1</td><td class="source">                retry = function () { this.storeOneToOne(entity, obj, callback, 1); }.bind(this);</td></tr><tr class=""><td class="line">134</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">135</td><td class="hits">32</td><td class="source">            if (entity[this.property] !== null) {</td></tr><tr class="hit"><td class="line">136</td><td class="hits">5</td><td class="source">                subentity = entity[this.property];</td></tr><tr class="hit"><td class="line">137</td><td class="hits">5</td><td class="source">                log(&quot;*OneToOne not null -&gt; &quot; + this.property, subentity[this.refColumn]);</td></tr><tr class=""><td class="line">138</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">139</td><td class="hits"></td><td class="source">                //store first and callme again!</td></tr><tr class="hit"><td class="line">140</td><td class="hits">5</td><td class="source">                if (subentity[this.refColumn] === null) {</td></tr><tr class="hit"><td class="line">141</td><td class="hits">1</td><td class="source">                    log(&quot;*OneToOne store&quot;);</td></tr><tr class="hit"><td class="line">142</td><td class="hits">1</td><td class="source">                    subentity.$store(retry);</td></tr><tr class=""><td class="line">143</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">144</td><td class="hits">1</td><td class="source">                    return true;</td></tr><tr class=""><td class="line">145</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">146</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">147</td><td class="hits">4</td><td class="source">                if (obj[this.foreignKey] == null) {</td></tr><tr class="hit"><td class="line">148</td><td class="hits">3</td><td class="source">                    log(&quot;*OneToOne store assign -&gt; &quot; + entity[this.property][this.refColumn]);</td></tr><tr class=""><td class="line">149</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">150</td><td class="hits">3</td><td class="source">                    obj[this.foreignKey] = entity[this.property][this.refColumn] || null;</td></tr><tr class="hit"><td class="line">151</td><td class="hits">3</td><td class="source">                    if (retried === 1) {</td></tr><tr class="hit"><td class="line">152</td><td class="hits">1</td><td class="source">                        callback &amp;&amp; callback();</td></tr><tr class=""><td class="line">153</td><td class="hits"></td><td class="source">                    }</td></tr><tr class="hit"><td class="line">154</td><td class="hits">3</td><td class="source">                    return false;</td></tr><tr class=""><td class="line">155</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">156</td><td class="hits">1</td><td class="source">                log(&quot;*OneToOne stored&quot;);</td></tr><tr class=""><td class="line">157</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">158</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">159</td><td class="hits">28</td><td class="source">            return false;</td></tr><tr class=""><td class="line">160</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">161</td><td class="hits"></td><td class="source">        storeOneToMany: function (entity, obj, callback, retried) {</td></tr><tr class="hit"><td class="line">162</td><td class="hits">17</td><td class="source">            var max,</td></tr><tr class=""><td class="line">163</td><td class="hits"></td><td class="source">                i,</td></tr><tr class=""><td class="line">164</td><td class="hits"></td><td class="source">                subentity_list,</td></tr><tr class=""><td class="line">165</td><td class="hits"></td><td class="source">                subentity,</td></tr><tr class="hit"><td class="line">166</td><td class="hits">2</td><td class="source">                retry = function () { this.storeOneToMany(entity, obj, callback, 1); }.bind(this);</td></tr><tr class=""><td class="line">167</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">168</td><td class="hits">17</td><td class="source">            subentity_list = entity[this.property];</td></tr><tr class="hit"><td class="line">169</td><td class="hits">17</td><td class="source">            max = subentity_list.length;</td></tr><tr class=""><td class="line">170</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">171</td><td class="hits">17</td><td class="source">            if (max !== 0) {</td></tr><tr class="hit"><td class="line">172</td><td class="hits">5</td><td class="source">                for (i = 0; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">8</td><td class="source">                    subentity = subentity_list[i];</td></tr><tr class=""><td class="line">174</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">175</td><td class="hits">8</td><td class="source">                    if (subentity[this.foreignKey] !== entity[this.refColumn]) {</td></tr><tr class="hit"><td class="line">176</td><td class="hits">2</td><td class="source">                        subentity[this.foreignKey] = entity[this.refColumn];</td></tr><tr class="hit"><td class="line">177</td><td class="hits">2</td><td class="source">                        subentity.$store(retry);</td></tr><tr class=""><td class="line">178</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">179</td><td class="hits">2</td><td class="source">                        return true;</td></tr><tr class=""><td class="line">180</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">181</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">182</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">183</td><td class="hits">15</td><td class="source">            if (retried === 1) {</td></tr><tr class="hit"><td class="line">184</td><td class="hits">1</td><td class="source">                callback &amp;&amp; callback();</td></tr><tr class=""><td class="line">185</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">186</td><td class="hits">15</td><td class="source">            return false;</td></tr><tr class=""><td class="line">187</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">188</td><td class="hits"></td><td class="source">        store: function (entity, obj, callback) {</td></tr><tr class="hit"><td class="line">189</td><td class="hits">46</td><td class="source">            log(&quot;## store relation:&quot;, this.type, this.property);</td></tr><tr class="hit"><td class="line">190</td><td class="hits">46</td><td class="source">            switch (this.type) {</td></tr><tr class=""><td class="line">191</td><td class="hits"></td><td class="source">            case ONE_TO_ONE:</td></tr><tr class=""><td class="line">192</td><td class="hits"></td><td class="source">            case MANY_TO_ONE:</td></tr><tr class="hit"><td class="line">193</td><td class="hits">31</td><td class="source">                return this.storeOneToOne(entity, obj, callback);</td></tr><tr class=""><td class="line">194</td><td class="hits"></td><td class="source">            case ONE_TO_MANY:</td></tr><tr class="hit"><td class="line">195</td><td class="hits">15</td><td class="source">                return this.storeOneToMany(entity, obj, callback);</td></tr><tr class=""><td class="line">196</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">197</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">198</td><td class="hits">0</td><td class="source">            return false;</td></tr><tr class=""><td class="line">199</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">200</td><td class="hits"></td><td class="source">        creation: function (entity, create, alters) {</td></tr><tr class=""><td class="line">201</td><td class="hits"></td><td class="source">            //console.log(&quot;************&quot;);</td></tr><tr class=""><td class="line">202</td><td class="hits"></td><td class="source">            //console.log(util.inspect(rel, {depth: 0, colors: true}));</td></tr><tr class=""><td class="line">203</td><td class="hits"></td><td class="source">            //console.log(&quot;************&quot;);</td></tr><tr class=""><td class="line">204</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">205</td><td class="hits">12</td><td class="source">            var r_tbl = this.root.$table,</td></tr><tr class=""><td class="line">206</td><td class="hits"></td><td class="source">                r_tbl_name = r_tbl.tableName,</td></tr><tr class=""><td class="line">207</td><td class="hits"></td><td class="source">                t_tbl = this.reference.$table,</td></tr><tr class=""><td class="line">208</td><td class="hits"></td><td class="source">                t_tbl_name = t_tbl.tableName;</td></tr><tr class=""><td class="line">209</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">210</td><td class="hits">12</td><td class="source">            switch (this.type) {</td></tr><tr class=""><td class="line">211</td><td class="hits"></td><td class="source">            case ONE_TO_MANY:</td></tr><tr class="hit"><td class="line">212</td><td class="hits">3</td><td class="source">                alters.push(&quot;ALTER TABLE `&quot; + t_tbl_name +</td></tr><tr class=""><td class="line">213</td><td class="hits"></td><td class="source">                    &quot;` ADD CONSTRAINT `fk_&quot; + t_tbl_name + &quot;_&quot; + this.foreignKey + &quot;` FOREIGN KEY (`&quot; + t_tbl.prefix + this.foreignKey + &quot;`)&quot; +</td></tr><tr class=""><td class="line">214</td><td class="hits"></td><td class="source">                    &quot; REFERENCES `&quot; + r_tbl_name + &quot;` (`&quot; + r_tbl.prefix + this.refColumn + &quot;`);&quot;);</td></tr><tr class="hit"><td class="line">215</td><td class="hits">3</td><td class="source">                break;</td></tr><tr class=""><td class="line">216</td><td class="hits"></td><td class="source">            case ONE_TO_ONE:</td></tr><tr class=""><td class="line">217</td><td class="hits"></td><td class="source">            case MANY_TO_ONE:</td></tr><tr class="hit"><td class="line">218</td><td class="hits">9</td><td class="source">                if (this.isRoot(entity)) {</td></tr><tr class="hit"><td class="line">219</td><td class="hits">6</td><td class="source">                    create.push(&quot;    UNIQUE INDEX `unique_&quot; + r_tbl_name + &quot;_&quot; + this.foreignKey + &quot;` (`&quot; + r_tbl.prefix + this.foreignKey + &quot;`)&quot;);</td></tr><tr class=""><td class="line">220</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">221</td><td class="hits">6</td><td class="source">                    alters.push(&quot;ALTER TABLE `&quot; + r_tbl_name +</td></tr><tr class=""><td class="line">222</td><td class="hits"></td><td class="source">                        &quot;` ADD CONSTRAINT `fk_&quot; + r_tbl_name + &quot;_&quot; + this.foreignKey + &quot;` FOREIGN KEY (`&quot; + r_tbl.prefix + this.foreignKey + &quot;`)&quot; +</td></tr><tr class=""><td class="line">223</td><td class="hits"></td><td class="source">                        &quot; REFERENCES `&quot; + t_tbl_name + &quot;` (`&quot; + t_tbl.prefix + this.refColumn + &quot;`);&quot;);</td></tr><tr class=""><td class="line">224</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">225</td><td class="hits">9</td><td class="source">                break;</td></tr><tr class=""><td class="line">226</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">227</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">228</td><td class="hits"></td><td class="source">        &quot;static OneToOne&quot;: function (root_entity, target_entity, options) {</td></tr><tr class="hit"><td class="line">229</td><td class="hits">6</td><td class="source">            var t_tbl = target_entity.$table,</td></tr><tr class=""><td class="line">230</td><td class="hits"></td><td class="source">                rel;</td></tr><tr class=""><td class="line">231</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">232</td><td class="hits">6</td><td class="source">            options = options || {};</td></tr><tr class=""><td class="line">233</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">234</td><td class="hits">6</td><td class="source">            rel = new Relation();</td></tr><tr class="hit"><td class="line">235</td><td class="hits">6</td><td class="source">            rel.type = ONE_TO_ONE;</td></tr><tr class=""><td class="line">236</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">237</td><td class="hits">6</td><td class="source">            rel.root = root_entity;</td></tr><tr class="hit"><td class="line">238</td><td class="hits">6</td><td class="source">            rel.reference = target_entity;</td></tr><tr class=""><td class="line">239</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">240</td><td class="hits">6</td><td class="source">            rel.canBeNull = options.canBeNull === true;</td></tr><tr class="hit"><td class="line">241</td><td class="hits">6</td><td class="source">            rel.unique = true; // it&apos;s one on one</td></tr><tr class=""><td class="line">242</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">243</td><td class="hits">6</td><td class="source">            rel.property = options.property || target_entity.$class.toLowerCase();</td></tr><tr class=""><td class="line">244</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">245</td><td class="hits"></td><td class="source">            //bidirectional ?</td></tr><tr class="hit"><td class="line">246</td><td class="hits">6</td><td class="source">            rel.refProperty = options.refProperty || null;</td></tr><tr class=""><td class="line">247</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">248</td><td class="hits">6</td><td class="source">            rel.refColumn = options.refColumn || t_tbl.primaryKey;</td></tr><tr class="hit"><td class="line">249</td><td class="hits">6</td><td class="source">            rel.foreignKey = options.foreignKey || t_tbl.prefix + rel.refColumn;</td></tr><tr class=""><td class="line">250</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">251</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">252</td><td class="hits"></td><td class="source">            // now modify the entities</td></tr><tr class=""><td class="line">253</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">254</td><td class="hits"></td><td class="source">            // properties where the relation is stored</td></tr><tr class="hit"><td class="line">255</td><td class="hits">6</td><td class="source">            root_entity.property(rel.property, null);</td></tr><tr class="hit"><td class="line">256</td><td class="hits">6</td><td class="source">            if (rel.refProperty) {</td></tr><tr class="hit"><td class="line">257</td><td class="hits">3</td><td class="source">                target_entity.property(rel.refProperty, null);</td></tr><tr class=""><td class="line">258</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">259</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">260</td><td class="hits"></td><td class="source">            // foreignKey in root</td></tr><tr class="hit"><td class="line">261</td><td class="hits">6</td><td class="source">            root_entity.$table.structure[rel.foreignKey] = t_tbl.structure[rel.refColumn];</td></tr><tr class="hit"><td class="line">262</td><td class="hits">6</td><td class="source">            root_entity.$table.fields.push(rel.foreignKey);</td></tr><tr class=""><td class="line">263</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">264</td><td class="hits">6</td><td class="source">            root_entity.$table.relations.push(rel);</td></tr><tr class=""><td class="line">265</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">266</td><td class="hits">6</td><td class="source">            if (rel.isBidirectional()) {</td></tr><tr class="hit"><td class="line">267</td><td class="hits">3</td><td class="source">                target_entity.$table.relations.push(rel);</td></tr><tr class=""><td class="line">268</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">269</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">270</td><td class="hits">6</td><td class="source">            return rel;</td></tr><tr class=""><td class="line">271</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">272</td><td class="hits"></td><td class="source">        &quot;static OneToMany&quot;: function (root_entity, target_entity, options) {</td></tr><tr class="hit"><td class="line">273</td><td class="hits">3</td><td class="source">            var t_tbl = target_entity.$table,</td></tr><tr class=""><td class="line">274</td><td class="hits"></td><td class="source">                r_tbl = root_entity.$table,</td></tr><tr class=""><td class="line">275</td><td class="hits"></td><td class="source">                rel;</td></tr><tr class=""><td class="line">276</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">277</td><td class="hits">3</td><td class="source">            options = options || {};</td></tr><tr class=""><td class="line">278</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">279</td><td class="hits">3</td><td class="source">            rel = new Relation();</td></tr><tr class="hit"><td class="line">280</td><td class="hits">3</td><td class="source">            rel.type = ONE_TO_MANY;</td></tr><tr class=""><td class="line">281</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">282</td><td class="hits">3</td><td class="source">            rel.root = root_entity;</td></tr><tr class="hit"><td class="line">283</td><td class="hits">3</td><td class="source">            rel.reference = target_entity;</td></tr><tr class=""><td class="line">284</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">285</td><td class="hits">3</td><td class="source">            rel.canBeNull = options.canBeNull === true;</td></tr><tr class="hit"><td class="line">286</td><td class="hits">3</td><td class="source">            rel.unique = false; // it&apos;s many on one</td></tr><tr class=""><td class="line">287</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">288</td><td class="hits">3</td><td class="source">            rel.property = options.property || target_entity.$class.toLowerCase();</td></tr><tr class=""><td class="line">289</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">290</td><td class="hits"></td><td class="source">            //bidirectional ?</td></tr><tr class="hit"><td class="line">291</td><td class="hits">3</td><td class="source">            rel.refProperty = options.refProperty || null;</td></tr><tr class=""><td class="line">292</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">293</td><td class="hits">3</td><td class="source">            rel.refColumn = options.refColumn || r_tbl.primaryKey;</td></tr><tr class="hit"><td class="line">294</td><td class="hits">3</td><td class="source">            rel.foreignKey = options.foreignKey || r_tbl.prefix + rel.refColumn;</td></tr><tr class=""><td class="line">295</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">296</td><td class="hits"></td><td class="source">            // properties where the relation is stored</td></tr><tr class="hit"><td class="line">297</td><td class="hits">3</td><td class="source">            root_entity.property(rel.property, []);</td></tr><tr class="hit"><td class="line">298</td><td class="hits">3</td><td class="source">            if (rel.refProperty) {</td></tr><tr class="miss"><td class="line">299</td><td class="hits">0</td><td class="source">                target_entity.property(rel.refProperty, null);</td></tr><tr class=""><td class="line">300</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">301</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">302</td><td class="hits"></td><td class="source">            // foreignKey in root</td></tr><tr class="hit"><td class="line">303</td><td class="hits">3</td><td class="source">            t_tbl.structure[rel.foreignKey] = r_tbl.structure[rel.refColumn];</td></tr><tr class="hit"><td class="line">304</td><td class="hits">3</td><td class="source">            t_tbl.fields.push(rel.foreignKey);</td></tr><tr class="hit"><td class="line">305</td><td class="hits">3</td><td class="source">            target_entity.$field(rel.foreignKey, null);</td></tr><tr class=""><td class="line">306</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">307</td><td class="hits">3</td><td class="source">            root_entity.$table.relations.push(rel);</td></tr><tr class=""><td class="line">308</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">309</td><td class="hits"></td><td class="source">            //add / remove</td></tr><tr class="hit"><td class="line">310</td><td class="hits">3</td><td class="source">            root_entity.method(camelCase(&quot;add-&quot; + options.property), function (cls) {</td></tr><tr class="hit"><td class="line">311</td><td class="hits">2</td><td class="source">                if (cls.$class !== target_entity.$class) {</td></tr><tr class="miss"><td class="line">312</td><td class="hits">0</td><td class="source">                    throw new Error(&quot;type-missmatch&quot;);</td></tr><tr class=""><td class="line">313</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">314</td><td class="hits">2</td><td class="source">                this[rel.property].push(cls);</td></tr><tr class=""><td class="line">315</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">316</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">317</td><td class="hits">3</td><td class="source">            root_entity.method(camelCase(&quot;remove-&quot; + options.property), function (cls) {</td></tr><tr class="hit"><td class="line">318</td><td class="hits">2</td><td class="source">                if (cls.$class !== target_entity.$class) {</td></tr><tr class="miss"><td class="line">319</td><td class="hits">0</td><td class="source">                    throw new Error(&quot;type-missmatch&quot;);</td></tr><tr class=""><td class="line">320</td><td class="hits"></td><td class="source">                }</td></tr><tr class="hit"><td class="line">321</td><td class="hits">2</td><td class="source">                var c = this[rel.property].indexOf(cls);</td></tr><tr class="hit"><td class="line">322</td><td class="hits">2</td><td class="source">                if (c &gt; -1) {</td></tr><tr class="hit"><td class="line">323</td><td class="hits">2</td><td class="source">                    this[rel.property].splice(c, 1);</td></tr><tr class="hit"><td class="line">324</td><td class="hits">2</td><td class="source">                    cls[rel.foreignKey] = null;</td></tr><tr class=""><td class="line">325</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">326</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">327</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">328</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">329</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">330</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">331</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">332</td><td class="hits">3</td><td class="source">            if (rel.isBidirectional()) {</td></tr><tr class="miss"><td class="line">333</td><td class="hits">0</td><td class="source">                target_entity.$table.relations.push(rel);</td></tr><tr class=""><td class="line">334</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">335</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">336</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">337</td><td class="hits">3</td><td class="source">            return rel;</td></tr><tr class=""><td class="line">338</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">339</td><td class="hits"></td><td class="source">        // many to one is a one to one, but without unique</td></tr><tr class=""><td class="line">340</td><td class="hits"></td><td class="source">        &quot;static ManyToOne&quot;: function (root_entity, target_entity, options) {</td></tr><tr class="miss"><td class="line">341</td><td class="hits">0</td><td class="source">            var rel = this.OneToOne(root_entity, target_entity, options);</td></tr><tr class="miss"><td class="line">342</td><td class="hits">0</td><td class="source">            rel.type = MANY_TO_ONE;</td></tr><tr class="miss"><td class="line">343</td><td class="hits">0</td><td class="source">            rel.unique = false;</td></tr><tr class=""><td class="line">344</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">345</td><td class="hits">0</td><td class="source">            return rel;</td></tr><tr class=""><td class="line">346</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">347</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">348</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">349</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">350</td><td class="hits">3</td><td class="source">    Relation.ONE_TO_ONE = ONE_TO_ONE;</td></tr><tr class="hit"><td class="line">351</td><td class="hits">3</td><td class="source">    Relation.MANY_TO_ONE = MANY_TO_ONE;</td></tr><tr class="hit"><td class="line">352</td><td class="hits">3</td><td class="source">    Relation.ONE_TO_MANY = ONE_TO_MANY;</td></tr><tr class=""><td class="line">353</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">354</td><td class="hits"></td><td class="source">    //var q = new Query();</td></tr><tr class=""><td class="line">355</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">356</td><td class="hits">3</td><td class="source">    module.exports = Relation;</td></tr><tr class=""><td class="line">357</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">358</td><td class="hits"></td><td class="source">}());</td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/lib/dba.js">/home/luis/noboxout/noboxout-orm/lib/dba.js</h2>
          <div class="stats high">
            <div class="percentage">55.1%</div>
            <div class="sloc">98</div>
            <div class="hits">54</div>
            <div class="misses">44</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">(function () {</td></tr><tr class="hit"><td class="line">2</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">3</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">4</td><td class="hits">3</td><td class="source">    var object = require(&quot;object-enhancements&quot;),</td></tr><tr class=""><td class="line">5</td><td class="hits"></td><td class="source">        util = require(&quot;util&quot;),</td></tr><tr class=""><td class="line">6</td><td class="hits"></td><td class="source">        mysql = require(&quot;mysql&quot;),</td></tr><tr class=""><td class="line">7</td><td class="hits"></td><td class="source">        Query = require(&quot;/home/luis/noboxout/noboxout-orm/lib/./query.js&quot;),</td></tr><tr class=""><td class="line">8</td><td class="hits"></td><td class="source">        db = mysql.createConnection(&quot;mysql://root:toor@localhost/norm&quot;),</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        $ = require(&quot;node-class&quot;),</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source">        __class = $.class,</td></tr><tr class=""><td class="line">11</td><td class="hits"></td><td class="source">        dba;</td></tr><tr class=""><td class="line">12</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">13</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">14</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">15</td><td class="hits">3</td><td class="source">    dba = __class(&quot;norm/dba&quot;, {</td></tr><tr class=""><td class="line">16</td><td class="hits"></td><td class="source">        mysql: {</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source">            escape: function (name) {</td></tr><tr class="hit"><td class="line">18</td><td class="hits">124</td><td class="source">                return db.escape(name);</td></tr><tr class=""><td class="line">19</td><td class="hits"></td><td class="source">            },</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source">            escapeId: function (name) {</td></tr><tr class="hit"><td class="line">21</td><td class="hits">126</td><td class="source">                return mysql.escapeId(name);</td></tr><tr class=""><td class="line">22</td><td class="hits"></td><td class="source">            },</td></tr><tr class=""><td class="line">23</td><td class="hits"></td><td class="source">            selectByPK: function (table_data, from, eager_level) {</td></tr><tr class="hit"><td class="line">24</td><td class="hits">15</td><td class="source">                eager_level = eager_level || 1;</td></tr><tr class=""><td class="line">25</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">26</td><td class="hits">15</td><td class="source">                var relations = table_data.relations,</td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source">                    i,</td></tr><tr class=""><td class="line">28</td><td class="hits"></td><td class="source">                    max,</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">                    query = new Query();</td></tr><tr class=""><td class="line">30</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">31</td><td class="hits">15</td><td class="source">                query.select(&quot;*&quot;, true);</td></tr><tr class="hit"><td class="line">32</td><td class="hits">15</td><td class="source">                query.from(table_data.tableName, &quot;root&quot;);</td></tr><tr class=""><td class="line">33</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">34</td><td class="hits">15</td><td class="source">                if (eager_level === 1 &amp;&amp; !object.empty(table_data.relations)) {</td></tr><tr class="hit"><td class="line">35</td><td class="hits">14</td><td class="source">                    for (i = 0, max = relations.length; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">36</td><td class="hits">36</td><td class="source">                        relations[i].apply(query, from);</td></tr><tr class=""><td class="line">37</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">38</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">39</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">40</td><td class="hits">15</td><td class="source">                query.andWhere(&quot;`root`.`&quot; + table_data.prefix + table_data.primaryKey + &quot;` = ?&quot;);</td></tr><tr class=""><td class="line">41</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">42</td><td class="hits">15</td><td class="source">                return query.getSql();</td></tr><tr class=""><td class="line">43</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">44</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">45</td><td class="hits"></td><td class="source">        querys: function (sqls, args, callback) {</td></tr><tr class="hit"><td class="line">46</td><td class="hits">3</td><td class="source">            if (&quot;function&quot; === typeof args) {</td></tr><tr class="hit"><td class="line">47</td><td class="hits">3</td><td class="source">                callback = args;</td></tr><tr class="hit"><td class="line">48</td><td class="hits">3</td><td class="source">                args = [];</td></tr><tr class=""><td class="line">49</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">50</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">51</td><td class="hits">3</td><td class="source">            var i,</td></tr><tr class=""><td class="line">52</td><td class="hits"></td><td class="source">                max = sqls.length,</td></tr><tr class=""><td class="line">53</td><td class="hits"></td><td class="source">                errors = [],</td></tr><tr class=""><td class="line">54</td><td class="hits"></td><td class="source">                results = [],</td></tr><tr class=""><td class="line">55</td><td class="hits"></td><td class="source">                stack_responses = function (err, result) {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">18</td><td class="source">                    errors.push(err);</td></tr><tr class="hit"><td class="line">57</td><td class="hits">18</td><td class="source">                    results.push(result);</td></tr><tr class="hit"><td class="line">58</td><td class="hits">18</td><td class="source">                    if (errors.length === max) {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">3</td><td class="source">                        callback &amp;&amp; callback(errors, results);</td></tr><tr class=""><td class="line">60</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">61</td><td class="hits"></td><td class="source">                };</td></tr><tr class=""><td class="line">62</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">63</td><td class="hits">3</td><td class="source">            for (i = 0; i &lt; max; ++i) {</td></tr><tr class="hit"><td class="line">64</td><td class="hits">18</td><td class="source">                this.query(sqls[i], stack_responses);</td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">66</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">67</td><td class="hits"></td><td class="source">        query: function (sql, args, callback) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">59</td><td class="source">            if (&quot;function&quot; === typeof args) {</td></tr><tr class="hit"><td class="line">69</td><td class="hits">44</td><td class="source">                callback = args;</td></tr><tr class="hit"><td class="line">70</td><td class="hits">44</td><td class="source">                args = [];</td></tr><tr class=""><td class="line">71</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">72</td><td class="hits">59</td><td class="source">            log(sql, args);</td></tr><tr class=""><td class="line">73</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">74</td><td class="hits">59</td><td class="source">            db.query(sql, args, callback);</td></tr><tr class=""><td class="line">75</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">76</td><td class="hits"></td><td class="source">        use: function (database, callback) {</td></tr><tr class="miss"><td class="line">77</td><td class="hits">0</td><td class="source">            this.query(&quot;USE &quot; + this.escapeId(database), function (err, result) {</td></tr><tr class="miss"><td class="line">78</td><td class="hits">0</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">79</td><td class="hits">0</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">80</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">81</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">82</td><td class="hits">0</td><td class="source">                callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">83</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">84</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">85</td><td class="hits"></td><td class="source">        dropDatabase: function (database_name, callback) {</td></tr><tr class="miss"><td class="line">86</td><td class="hits">0</td><td class="source">            var sql = &quot;DROP &quot; + this.mysql.escapeId(database_name);</td></tr><tr class="miss"><td class="line">87</td><td class="hits">0</td><td class="source">            this.query(sql, function (err, result) {</td></tr><tr class="miss"><td class="line">88</td><td class="hits">0</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">89</td><td class="hits">0</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">90</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">91</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">92</td><td class="hits">0</td><td class="source">                callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">93</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">94</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">95</td><td class="hits"></td><td class="source">        dropTable: function (table_name, callback) {</td></tr><tr class="hit"><td class="line">96</td><td class="hits">9</td><td class="source">            var sql = &quot;DROP TABLE &quot; + this.mysql.escapeId(table_name);</td></tr><tr class="hit"><td class="line">97</td><td class="hits">9</td><td class="source">            this.query(sql, function (err, result) {</td></tr><tr class="hit"><td class="line">98</td><td class="hits">9</td><td class="source">                if (err) {</td></tr><tr class="hit"><td class="line">99</td><td class="hits">3</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">100</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">101</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">102</td><td class="hits">9</td><td class="source">                callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">103</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">104</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">105</td><td class="hits"></td><td class="source">        truncate: function (table_name, callback) {</td></tr><tr class="miss"><td class="line">106</td><td class="hits">0</td><td class="source">            var sql = &quot;TRUNCATE TABLE &quot; + this.mysql.escapeId(table_name);</td></tr><tr class=""><td class="line">107</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">108</td><td class="hits">0</td><td class="source">            this.query(sql, function (err, result) {</td></tr><tr class="miss"><td class="line">109</td><td class="hits">0</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">110</td><td class="hits">0</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">111</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">112</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">113</td><td class="hits">0</td><td class="source">                callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">114</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">115</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">116</td><td class="hits"></td><td class="source">        deleteAll: function (table_name, callback, reset_auto_increment) {</td></tr><tr class=""><td class="line">117</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">118</td><td class="hits">0</td><td class="source">            var esc_table_name = this.mysql.escapeId(table_name),</td></tr><tr class=""><td class="line">119</td><td class="hits"></td><td class="source">                sql = &quot;DELETE FROM &quot; + esc_table_name + &quot; WHERE 1&quot;;</td></tr><tr class="miss"><td class="line">120</td><td class="hits">0</td><td class="source">            reset_auto_increment = reset_auto_increment || false;</td></tr><tr class=""><td class="line">121</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">122</td><td class="hits">0</td><td class="source">            this.query(sql, function (err, result) {</td></tr><tr class="miss"><td class="line">123</td><td class="hits">0</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">124</td><td class="hits">0</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">125</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">126</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">127</td><td class="hits">0</td><td class="source">                if (!reset_auto_increment) {</td></tr><tr class="miss"><td class="line">128</td><td class="hits">0</td><td class="source">                    return callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">129</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">130</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">131</td><td class="hits">0</td><td class="source">                var sql = &quot;ALTER TABLE &quot; + esc_table_name + &quot; AUTO_INCREMENT = 1&quot;;</td></tr><tr class="miss"><td class="line">132</td><td class="hits">0</td><td class="source">                this.query(sql, function (err, result) {</td></tr><tr class="miss"><td class="line">133</td><td class="hits">0</td><td class="source">                    if (err) {</td></tr><tr class="miss"><td class="line">134</td><td class="hits">0</td><td class="source">                        console.error(err);</td></tr><tr class=""><td class="line">135</td><td class="hits"></td><td class="source">                    }</td></tr><tr class=""><td class="line">136</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">137</td><td class="hits">0</td><td class="source">                    callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">138</td><td class="hits"></td><td class="source">                });</td></tr><tr class=""><td class="line">139</td><td class="hits"></td><td class="source">            }.bind(this));</td></tr><tr class=""><td class="line">140</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">141</td><td class="hits"></td><td class="source">        findQuery: function (table, where, limit) {</td></tr><tr class="miss"><td class="line">142</td><td class="hits">0</td><td class="source">            limit = limit === undefined ? 1 : parseInt(limit);</td></tr><tr class="miss"><td class="line">143</td><td class="hits">0</td><td class="source">            if (limit === 0 || isNaN(limit)) {</td></tr><tr class="miss"><td class="line">144</td><td class="hits">0</td><td class="source">                console.error(&quot;limit&quot;, limit);</td></tr><tr class="miss"><td class="line">145</td><td class="hits">0</td><td class="source">                throw new Error(&quot;invalid limit parameter&quot;);</td></tr><tr class=""><td class="line">146</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">147</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">148</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">149</td><td class="hits">0</td><td class="source">            var sql_where = [],</td></tr><tr class=""><td class="line">150</td><td class="hits"></td><td class="source">                i;</td></tr><tr class=""><td class="line">151</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">152</td><td class="hits">0</td><td class="source">            for (i in where) {</td></tr><tr class="miss"><td class="line">153</td><td class="hits">0</td><td class="source">                sql_where = this.mysql.escapeId(i) + &quot; = &quot; + this.mysql.escape(where[i]);</td></tr><tr class=""><td class="line">154</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">155</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">156</td><td class="hits">0</td><td class="source">            var sql = &quot;SELECT * FROM `&quot; + table + &quot;` WHERE `&quot; + sql_where.join(&quot; AND &quot;);</td></tr><tr class=""><td class="line">157</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">158</td><td class="hits">0</td><td class="source">            return sql;</td></tr><tr class=""><td class="line">159</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">160</td><td class="hits"></td><td class="source">        insert: function (table, key, data, callback) {</td></tr><tr class="hit"><td class="line">161</td><td class="hits">10</td><td class="source">            var sql;</td></tr><tr class=""><td class="line">162</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">163</td><td class="hits"></td><td class="source">            //ok! --&gt; obj[pk] = result.insertId</td></tr><tr class="hit"><td class="line">164</td><td class="hits">10</td><td class="source">            var keys = Object.keys(data).map(this.mysql.escapeId),</td></tr><tr class=""><td class="line">165</td><td class="hits"></td><td class="source">                values = object.values(data).map(this.mysql.escape);</td></tr><tr class="hit"><td class="line">166</td><td class="hits">10</td><td class="source">            sql = &quot;INSERT INTO `&quot; + table + &quot;` (&quot; + keys.join(&quot;,&quot;) + &quot;) VALUES(&quot; + values.join(&quot;,&quot;) + &quot;)&quot;;</td></tr><tr class=""><td class="line">167</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">168</td><td class="hits">10</td><td class="source">            this.query(sql, function (err, result) {</td></tr><tr class="hit"><td class="line">169</td><td class="hits">10</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">170</td><td class="hits">0</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">171</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">172</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">173</td><td class="hits">10</td><td class="source">                callback &amp;&amp; callback(err, !result ? null : result.insertId, result);</td></tr><tr class=""><td class="line">174</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">175</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">176</td><td class="hits"></td><td class="source">        update: function (table, key, data, callback) {</td></tr><tr class="hit"><td class="line">177</td><td class="hits">7</td><td class="source">            var sets = [],</td></tr><tr class=""><td class="line">178</td><td class="hits"></td><td class="source">                i,</td></tr><tr class=""><td class="line">179</td><td class="hits"></td><td class="source">                sql;</td></tr><tr class=""><td class="line">180</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">181</td><td class="hits">7</td><td class="source">            for (i in data) {</td></tr><tr class="hit"><td class="line">182</td><td class="hits">56</td><td class="source">                if (i !== key) {</td></tr><tr class="hit"><td class="line">183</td><td class="hits">49</td><td class="source">                    sets.push(this.mysql.escapeId(i) + &quot; = &quot; + this.mysql.escape(data[i]));</td></tr><tr class=""><td class="line">184</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">185</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">186</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">187</td><td class="hits">7</td><td class="source">            sql = &quot;UPDATE `&quot; + table + &quot;` SET &quot; + sets.join(&quot;,&quot;) + &quot; WHERE `&quot; + key + &quot;` = &quot; + this.mysql.escape(data[key]);</td></tr><tr class=""><td class="line">188</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">189</td><td class="hits">7</td><td class="source">            this.query(sql, function (err, result) {</td></tr><tr class="hit"><td class="line">190</td><td class="hits">7</td><td class="source">                if (err) {</td></tr><tr class="miss"><td class="line">191</td><td class="hits">0</td><td class="source">                    console.error(err);</td></tr><tr class=""><td class="line">192</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">193</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">194</td><td class="hits">7</td><td class="source">                callback &amp;&amp; callback(err, data[key], result);</td></tr><tr class=""><td class="line">195</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">196</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">197</td><td class="hits"></td><td class="source">        store: function (table, key, data, callback) {</td></tr><tr class="hit"><td class="line">198</td><td class="hits">17</td><td class="source">            if (data[key] == null) { // leave double equals for now</td></tr><tr class="hit"><td class="line">199</td><td class="hits">10</td><td class="source">                this.insert(table, key, data, callback);</td></tr><tr class=""><td class="line">200</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">201</td><td class="hits">10</td><td class="source">                return;</td></tr><tr class=""><td class="line">202</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">203</td><td class="hits">7</td><td class="source">            this.update(table, key, data, callback);</td></tr><tr class=""><td class="line">204</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">205</td><td class="hits"></td><td class="source">        // , nestTables: true</td></tr><tr class=""><td class="line">206</td><td class="hits"></td><td class="source">        selectOne: function (sql, args, callback) {</td></tr><tr class="miss"><td class="line">207</td><td class="hits">0</td><td class="source">            if (!callback) {</td></tr><tr class="miss"><td class="line">208</td><td class="hits">0</td><td class="source">                callback = args;</td></tr><tr class="miss"><td class="line">209</td><td class="hits">0</td><td class="source">                args = undefined;</td></tr><tr class=""><td class="line">210</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">211</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">212</td><td class="hits">0</td><td class="source">            this.query(sql, args, function (err, result) {</td></tr><tr class="miss"><td class="line">213</td><td class="hits">0</td><td class="source">                if (!err) {</td></tr><tr class="miss"><td class="line">214</td><td class="hits">0</td><td class="source">                    result = result &amp;&amp; result[0] ? result[0] : null;</td></tr><tr class=""><td class="line">215</td><td class="hits"></td><td class="source">                }</td></tr><tr class=""><td class="line">216</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">217</td><td class="hits">0</td><td class="source">                callback &amp;&amp; callback(err, result);</td></tr><tr class=""><td class="line">218</td><td class="hits"></td><td class="source">            });</td></tr><tr class=""><td class="line">219</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">220</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">221</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">222</td><td class="hits">3</td><td class="source">    module.exports = dba;</td></tr><tr class=""><td class="line">223</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">224</td><td class="hits"></td><td class="source">}());</td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/lib/query.js">/home/luis/noboxout/noboxout-orm/lib/query.js</h2>
          <div class="stats high">
            <div class="percentage">80.5%</div>
            <div class="sloc">41</div>
            <div class="hits">33</div>
            <div class="misses">8</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">(function () {</td></tr><tr class="hit"><td class="line">2</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">3</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">4</td><td class="hits">3</td><td class="source">    require(&quot;/home/luis/noboxout/noboxout-orm/lib/./entity.js&quot;);</td></tr><tr class=""><td class="line">5</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">6</td><td class="hits">3</td><td class="source">    var $ = require(&quot;node-class&quot;),</td></tr><tr class=""><td class="line">7</td><td class="hits"></td><td class="source">        __class = $.class,</td></tr><tr class=""><td class="line">8</td><td class="hits"></td><td class="source">        Query,</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        escapeId = require(&quot;mysql&quot;).escapeId;</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">11</td><td class="hits">3</td><td class="source">    function arEscapeId(combo) {</td></tr><tr class="hit"><td class="line">12</td><td class="hits">72</td><td class="source">        if (Array.isArray(combo)) {</td></tr><tr class="hit"><td class="line">13</td><td class="hits">72</td><td class="source">            if (combo.length !== 2) {</td></tr><tr class="miss"><td class="line">14</td><td class="hits">0</td><td class="source">                throw new Error(&quot;wtf!?&quot;);</td></tr><tr class=""><td class="line">15</td><td class="hits"></td><td class="source">            }</td></tr><tr class="hit"><td class="line">16</td><td class="hits">72</td><td class="source">            return escapeId(combo[0]) + &quot;.&quot; + escapeId(combo[1]);</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source">        }</td></tr><tr class="miss"><td class="line">18</td><td class="hits">0</td><td class="source">        return escapeId(combo);</td></tr><tr class=""><td class="line">19</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">21</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">22</td><td class="hits">3</td><td class="source">    Query = __class(&quot;norm/query&quot;, {</td></tr><tr class=""><td class="line">23</td><td class="hits"></td><td class="source">        parts: {</td></tr><tr class=""><td class="line">24</td><td class="hits"></td><td class="source">            select: [],</td></tr><tr class=""><td class="line">25</td><td class="hits"></td><td class="source">            from: [],</td></tr><tr class=""><td class="line">26</td><td class="hits"></td><td class="source">            joins: [],</td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source">            where: [],</td></tr><tr class=""><td class="line">28</td><td class="hits"></td><td class="source">            offset: 0,</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">            limit: 0</td></tr><tr class=""><td class="line">30</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">31</td><td class="hits"></td><td class="source">        _getSelect: function (p) {</td></tr><tr class="hit"><td class="line">32</td><td class="hits">15</td><td class="source">            return &quot;SELECT &quot; + p.select.map(function (v) {</td></tr><tr class="hit"><td class="line">33</td><td class="hits">15</td><td class="source">                if (v[0] === &quot;@&quot;) {</td></tr><tr class="hit"><td class="line">34</td><td class="hits">15</td><td class="source">                    return v.substring(1, v.length - 1);</td></tr><tr class=""><td class="line">35</td><td class="hits"></td><td class="source">                }</td></tr><tr class="miss"><td class="line">36</td><td class="hits">0</td><td class="source">                return escapeId(v);</td></tr><tr class=""><td class="line">37</td><td class="hits"></td><td class="source">            }).join(&quot;,&quot;);</td></tr><tr class=""><td class="line">38</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">39</td><td class="hits"></td><td class="source">        _getFrom: function (p) {</td></tr><tr class="hit"><td class="line">40</td><td class="hits">15</td><td class="source">            return &quot; FROM &quot; + escapeId(p.from[0]) + &quot; AS &quot; + escapeId(p.from[1]) +</td></tr><tr class=""><td class="line">41</td><td class="hits"></td><td class="source">                (p.joins.length ?</td></tr><tr class=""><td class="line">42</td><td class="hits"></td><td class="source">                    (&quot; &quot; + p.joins.map(function (v) {</td></tr><tr class="hit"><td class="line">43</td><td class="hits">36</td><td class="source">                        v[1] = escapeId(v[1]);</td></tr><tr class="hit"><td class="line">44</td><td class="hits">36</td><td class="source">                        v[3] = escapeId(v[3]);</td></tr><tr class="hit"><td class="line">45</td><td class="hits">36</td><td class="source">                        v[5] = arEscapeId(v[5]);</td></tr><tr class="hit"><td class="line">46</td><td class="hits">36</td><td class="source">                        v[7] = arEscapeId(v[7]);</td></tr><tr class="hit"><td class="line">47</td><td class="hits">36</td><td class="source">                        return v.join(&quot; &quot;);</td></tr><tr class=""><td class="line">48</td><td class="hits"></td><td class="source">                    }).join(&quot; &quot;)</td></tr><tr class=""><td class="line">49</td><td class="hits"></td><td class="source">                ) : &quot;&quot;);</td></tr><tr class=""><td class="line">50</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">51</td><td class="hits"></td><td class="source">        _getWhere: function (p) {</td></tr><tr class="hit"><td class="line">52</td><td class="hits">15</td><td class="source">            return &quot; WHERE &quot; + ((p.where.join(&quot; AND &quot;)) || 1) +</td></tr><tr class=""><td class="line">53</td><td class="hits"></td><td class="source">                (p.limit !== 0 ? (&quot;LIMIT &quot; + p.offset + &quot;, &quot; + p.limit) : &quot;&quot;);</td></tr><tr class=""><td class="line">54</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">55</td><td class="hits"></td><td class="source">        getRootAlias: function () {</td></tr><tr class="hit"><td class="line">56</td><td class="hits">36</td><td class="source">            return this.parts.from[1];</td></tr><tr class=""><td class="line">57</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">58</td><td class="hits"></td><td class="source">        getSql: function () {</td></tr><tr class="hit"><td class="line">59</td><td class="hits">15</td><td class="source">            var p = this.parts;</td></tr><tr class=""><td class="line">60</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">61</td><td class="hits">15</td><td class="source">            return [</td></tr><tr class=""><td class="line">62</td><td class="hits"></td><td class="source">                this._getSelect(p),</td></tr><tr class=""><td class="line">63</td><td class="hits"></td><td class="source">                this._getFrom(p),</td></tr><tr class=""><td class="line">64</td><td class="hits"></td><td class="source">                this._getWhere(p)</td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source">            ].join(&quot; &quot;);</td></tr><tr class=""><td class="line">66</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">67</td><td class="hits"></td><td class="source">        select: function (v, literal) {</td></tr><tr class="hit"><td class="line">68</td><td class="hits">15</td><td class="source">            if (!literal) {</td></tr><tr class="miss"><td class="line">69</td><td class="hits">0</td><td class="source">                this.parts.select.push(v);</td></tr><tr class=""><td class="line">70</td><td class="hits"></td><td class="source">            } else {</td></tr><tr class="hit"><td class="line">71</td><td class="hits">15</td><td class="source">                this.parts.select.push(&quot;@&quot; + v + &quot;@&quot;);</td></tr><tr class=""><td class="line">72</td><td class="hits"></td><td class="source">            }</td></tr><tr class=""><td class="line">73</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">74</td><td class="hits">15</td><td class="source">            return this;</td></tr><tr class=""><td class="line">75</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">76</td><td class="hits"></td><td class="source">        min: function (v) {},</td></tr><tr class=""><td class="line">77</td><td class="hits"></td><td class="source">        max: function (v) {},</td></tr><tr class=""><td class="line">78</td><td class="hits"></td><td class="source">        avg: function (v) {},</td></tr><tr class=""><td class="line">79</td><td class="hits"></td><td class="source">        sum: function (v) {},</td></tr><tr class=""><td class="line">80</td><td class="hits"></td><td class="source">        count: function (v) {},</td></tr><tr class=""><td class="line">81</td><td class="hits"></td><td class="source">        limit: function (v) {},</td></tr><tr class=""><td class="line">82</td><td class="hits"></td><td class="source">        offset: function (v) {},</td></tr><tr class=""><td class="line">83</td><td class="hits"></td><td class="source">        groupBy: function (v) {},</td></tr><tr class=""><td class="line">84</td><td class="hits"></td><td class="source">        order: function (v, asc) {},</td></tr><tr class=""><td class="line">85</td><td class="hits"></td><td class="source">        from: function (root_table, alias) {</td></tr><tr class="hit"><td class="line">86</td><td class="hits">15</td><td class="source">            alias = alias || &quot;root&quot;;</td></tr><tr class=""><td class="line">87</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">88</td><td class="hits">15</td><td class="source">            this.parts.from = [root_table, alias];</td></tr><tr class=""><td class="line">89</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">90</td><td class="hits">15</td><td class="source">            return this;</td></tr><tr class=""><td class="line">91</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">92</td><td class="hits"></td><td class="source">        joinLeft: function (target, alias, left_size, right_size) {</td></tr><tr class="hit"><td class="line">93</td><td class="hits">36</td><td class="source">            this.parts.joins.push([&quot;LEFT JOIN&quot;, target, &quot;AS&quot;, alias, &quot;ON&quot;, left_size, &quot;=&quot;, right_size]);</td></tr><tr class=""><td class="line">94</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">95</td><td class="hits">36</td><td class="source">            return this;</td></tr><tr class=""><td class="line">96</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">97</td><td class="hits"></td><td class="source">        joinRight: function (target, alias, left_size, right_size) {</td></tr><tr class="miss"><td class="line">98</td><td class="hits">0</td><td class="source">            this.parts.joins.push([&quot;RIGHT JOIN&quot;, target, &quot;AS&quot;, alias, &quot;ON&quot;, left_size, &quot;=&quot;, right_size]);</td></tr><tr class=""><td class="line">99</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">100</td><td class="hits">0</td><td class="source">            return this;</td></tr><tr class=""><td class="line">101</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">102</td><td class="hits"></td><td class="source">        joinInner: function (target, alias, left_size, right_size) {</td></tr><tr class="miss"><td class="line">103</td><td class="hits">0</td><td class="source">            this.parts.joins.push([&quot;INNER JOIN&quot;, alias, target, left_size, right_size]);</td></tr><tr class=""><td class="line">104</td><td class="hits"></td><td class="source"></td></tr><tr class="miss"><td class="line">105</td><td class="hits">0</td><td class="source">            return this;</td></tr><tr class=""><td class="line">106</td><td class="hits"></td><td class="source">        },</td></tr><tr class=""><td class="line">107</td><td class="hits"></td><td class="source">        andWhere: function (where) {</td></tr><tr class="hit"><td class="line">108</td><td class="hits">15</td><td class="source">            this.parts.where.push(where);</td></tr><tr class=""><td class="line">109</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">110</td><td class="hits">15</td><td class="source">            return this;</td></tr><tr class=""><td class="line">111</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">112</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">113</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">114</td><td class="hits">3</td><td class="source">    module.exports = Query;</td></tr><tr class=""><td class="line">115</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">116</td><td class="hits"></td><td class="source">}());</td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/lib/mysql.js">/home/luis/noboxout/noboxout-orm/lib/mysql.js</h2>
          <div class="stats high">
            <div class="percentage">NaN%</div>
            <div class="sloc">0</div>
            <div class="hits">0</div>
            <div class="misses">0</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class=""><td class="line">1</td><td class="hits"></td><td class="source"></td></tr></tbody>
          </table>
        </div><div class="file">
          <h2 id="/home/luis/noboxout/noboxout-orm/test/test-models.js">/home/luis/noboxout/noboxout-orm/test/test-models.js</h2>
          <div class="stats high">
            <div class="percentage">100.0%</div>
            <div class="sloc">74</div>
            <div class="hits">74</div>
            <div class="misses">0</div>
          </div>
          <table id="source">
            <thead>
              <tr><th>Line</th><th>Hits</th><th>Source</th></tr>
            </thead>
            <tbody>
              <tr class="template"><td class="line"></td><td class="hits"></td><td class="source"></td></tr>
            <tr class="hit"><td class="line">1</td><td class="hits">3</td><td class="source">module.exports = function (test, dba) {</td></tr><tr class="hit"><td class="line">2</td><td class="hits">3</td><td class="source">    &quot;use strict&quot;;</td></tr><tr class=""><td class="line">3</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">4</td><td class="hits">3</td><td class="source">    var norm = require(&quot;/home/luis/noboxout/noboxout-orm/test/../index.js&quot;).Norm,</td></tr><tr class=""><td class="line">5</td><td class="hits"></td><td class="source">        object = require(&quot;object-enhancements&quot;),</td></tr><tr class=""><td class="line">6</td><td class="hits"></td><td class="source">        array = require(&quot;array-enhancements&quot;),</td></tr><tr class=""><td class="line">7</td><td class="hits"></td><td class="source">        fun = require(&quot;function-enhancements&quot;),</td></tr><tr class=""><td class="line">8</td><td class="hits"></td><td class="source">        Tag,</td></tr><tr class=""><td class="line">9</td><td class="hits"></td><td class="source">        Session,</td></tr><tr class=""><td class="line">10</td><td class="hits"></td><td class="source">        User,</td></tr><tr class=""><td class="line">11</td><td class="hits"></td><td class="source">        ret,</td></tr><tr class=""><td class="line">12</td><td class="hits"></td><td class="source">        i;</td></tr><tr class=""><td class="line">13</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">14</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">15</td><td class="hits">3</td><td class="source">    Tag = norm.define(&quot;Tag&quot;, {</td></tr><tr class=""><td class="line">16</td><td class="hits"></td><td class="source">        id: norm.Number.LENGTH(10).UNSIGNED,</td></tr><tr class=""><td class="line">17</td><td class="hits"></td><td class="source">        name: norm.String.LENGTH(255),</td></tr><tr class=""><td class="line">18</td><td class="hits"></td><td class="source">        initialize: function () {</td></tr><tr class="hit"><td class="line">19</td><td class="hits">17</td><td class="source">            this.__parent();</td></tr><tr class=""><td class="line">20</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">21</td><td class="hits"></td><td class="source">    }, {</td></tr><tr class=""><td class="line">22</td><td class="hits"></td><td class="source">        prefix: &quot;tag_&quot;,</td></tr><tr class=""><td class="line">23</td><td class="hits"></td><td class="source">        tableName: &quot;tags&quot;</td></tr><tr class=""><td class="line">24</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">25</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">26</td><td class="hits">3</td><td class="source">    Session = norm.define(&quot;Session&quot;, {</td></tr><tr class=""><td class="line">27</td><td class="hits"></td><td class="source">        id: norm.Number.LENGTH(10).ZEROFILL.UNSIGNED,</td></tr><tr class=""><td class="line">28</td><td class="hits"></td><td class="source">        start_date: norm.Date.NOTNULL,</td></tr><tr class=""><td class="line">29</td><td class="hits"></td><td class="source">        initialize: function () {</td></tr><tr class="hit"><td class="line">30</td><td class="hits">5</td><td class="source">            this.__parent();</td></tr><tr class=""><td class="line">31</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">32</td><td class="hits"></td><td class="source">    }, {</td></tr><tr class=""><td class="line">33</td><td class="hits"></td><td class="source">        prefix: &quot;sess_&quot;,</td></tr><tr class=""><td class="line">34</td><td class="hits"></td><td class="source">        tableName: &quot;sessions&quot;</td></tr><tr class=""><td class="line">35</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">36</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">37</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">38</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">39</td><td class="hits">3</td><td class="source">    User = norm.define(&quot;User&quot;, {</td></tr><tr class=""><td class="line">40</td><td class="hits"></td><td class="source">        id: norm.Number.LENGTH(10).UNSIGNED,</td></tr><tr class=""><td class="line">41</td><td class="hits"></td><td class="source">        login: norm.String.LENGTH(255),</td></tr><tr class=""><td class="line">42</td><td class="hits"></td><td class="source">        email: norm.String.LENGTH(255),</td></tr><tr class=""><td class="line">43</td><td class="hits"></td><td class="source">        initialize: function () {</td></tr><tr class="hit"><td class="line">44</td><td class="hits">22</td><td class="source">            this.__parent();</td></tr><tr class=""><td class="line">45</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">46</td><td class="hits"></td><td class="source">    }, {</td></tr><tr class=""><td class="line">47</td><td class="hits"></td><td class="source">        prefix: &quot;user_&quot;,</td></tr><tr class=""><td class="line">48</td><td class="hits"></td><td class="source">        tableName: &quot;users&quot;</td></tr><tr class=""><td class="line">49</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">50</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">51</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">52</td><td class="hits"></td><td class="source">    //</td></tr><tr class=""><td class="line">53</td><td class="hits"></td><td class="source">    // One on One - unidirectional</td></tr><tr class=""><td class="line">54</td><td class="hits"></td><td class="source">    //</td></tr><tr class="hit"><td class="line">55</td><td class="hits">3</td><td class="source">    User.$hasOne(Tag, {</td></tr><tr class=""><td class="line">56</td><td class="hits"></td><td class="source">        property: &quot;main_tag&quot;,</td></tr><tr class=""><td class="line">57</td><td class="hits"></td><td class="source">        canBeNull: true</td></tr><tr class=""><td class="line">58</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">59</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">60</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">61</td><td class="hits"></td><td class="source">    //</td></tr><tr class=""><td class="line">62</td><td class="hits"></td><td class="source">    // One on One - bidirectional</td></tr><tr class=""><td class="line">63</td><td class="hits"></td><td class="source">    //</td></tr><tr class="hit"><td class="line">64</td><td class="hits">3</td><td class="source">    User.$hasOne(Session, {</td></tr><tr class=""><td class="line">65</td><td class="hits"></td><td class="source">        property: &quot;session&quot;,</td></tr><tr class=""><td class="line">66</td><td class="hits"></td><td class="source">        canBeNull: true,</td></tr><tr class=""><td class="line">67</td><td class="hits"></td><td class="source">        refProperty: &quot;owner&quot; // this makes it bidirectional</td></tr><tr class=""><td class="line">68</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">69</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">70</td><td class="hits"></td><td class="source">    // One to Many - unidirectional</td></tr><tr class="hit"><td class="line">71</td><td class="hits">3</td><td class="source">    User.$hasMany(User, {</td></tr><tr class=""><td class="line">72</td><td class="hits"></td><td class="source">        property: &quot;mentors&quot;,</td></tr><tr class=""><td class="line">73</td><td class="hits"></td><td class="source">        foreignKey: &quot;mentor_id&quot;,</td></tr><tr class=""><td class="line">74</td><td class="hits"></td><td class="source">        canBeNull: true</td></tr><tr class=""><td class="line">75</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">76</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">77</td><td class="hits">3</td><td class="source">    i = 2;</td></tr><tr class="hit"><td class="line">78</td><td class="hits">3</td><td class="source">    while (i--) {</td></tr><tr class="hit"><td class="line">79</td><td class="hits">6</td><td class="source">        test(&quot;common model tests&quot;, function (t) {</td></tr><tr class="hit"><td class="line">80</td><td class="hits">6</td><td class="source">            var tag = new Tag();</td></tr><tr class=""><td class="line">81</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">82</td><td class="hits">6</td><td class="source">            t.equal(tag.$data.id, null, &quot;data.id is null&quot;);</td></tr><tr class="hit"><td class="line">83</td><td class="hits">6</td><td class="source">            t.equal(tag.$data.name, null, &quot;data.name is null&quot;);</td></tr><tr class=""><td class="line">84</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">85</td><td class="hits">6</td><td class="source">            t.equal(tag.id, null, &quot;id is null&quot;);</td></tr><tr class="hit"><td class="line">86</td><td class="hits">6</td><td class="source">            t.equal(tag.name, null, &quot;name is null&quot;);</td></tr><tr class="hit"><td class="line">87</td><td class="hits">6</td><td class="source">            t.equal(tag.$dirty, false, &quot;dirty is null&quot;);</td></tr><tr class=""><td class="line">88</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">89</td><td class="hits">6</td><td class="source">            tag.name = &quot;test&quot;;</td></tr><tr class="hit"><td class="line">90</td><td class="hits">6</td><td class="source">            t.equal(tag.name, &quot;test&quot;, &quot;name is null&quot;);</td></tr><tr class="hit"><td class="line">91</td><td class="hits">6</td><td class="source">            t.equal(tag.$dirty, true, &quot;dirty is null&quot;);</td></tr><tr class=""><td class="line">92</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">93</td><td class="hits">6</td><td class="source">            t.equal(tag.$data.name, &quot;test&quot;, &quot;data.name is null&quot;);</td></tr><tr class=""><td class="line">94</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">95</td><td class="hits">6</td><td class="source">            t.end();</td></tr><tr class=""><td class="line">96</td><td class="hits"></td><td class="source">        });</td></tr><tr class=""><td class="line">97</td><td class="hits"></td><td class="source">    }</td></tr><tr class=""><td class="line">98</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">99</td><td class="hits">3</td><td class="source">    test(&quot;model diffs&quot;, function (t) {</td></tr><tr class="hit"><td class="line">100</td><td class="hits">3</td><td class="source">        var tag = new Tag({name: &quot;xxx&quot;});</td></tr><tr class=""><td class="line">101</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">102</td><td class="hits">3</td><td class="source">        t.equal(object.empty(tag.$changes()), true, &quot;there is no changes yet!&quot;);</td></tr><tr class=""><td class="line">103</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">104</td><td class="hits">3</td><td class="source">        tag.name = &quot;yyy&quot;;</td></tr><tr class=""><td class="line">105</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">106</td><td class="hits">3</td><td class="source">        t.deepEqual(tag.$changes(), {name: &quot;yyy&quot;}, &quot;there is no changes yet!&quot;);</td></tr><tr class=""><td class="line">107</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">108</td><td class="hits">3</td><td class="source">        tag = new Tag();</td></tr><tr class=""><td class="line">109</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">110</td><td class="hits">3</td><td class="source">        t.equal(tag.$data.id, null, &quot;data.id is null&quot;);</td></tr><tr class="hit"><td class="line">111</td><td class="hits">3</td><td class="source">        t.equal(tag.$data.name, null, &quot;data.name is null&quot;);</td></tr><tr class=""><td class="line">112</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">113</td><td class="hits">3</td><td class="source">        t.equal(tag.id, null, &quot;id is null&quot;);</td></tr><tr class="hit"><td class="line">114</td><td class="hits">3</td><td class="source">        t.equal(tag.name, null, &quot;name is null&quot;);</td></tr><tr class="hit"><td class="line">115</td><td class="hits">3</td><td class="source">        t.equal(tag.$dirty, false, &quot;dirty is null&quot;);</td></tr><tr class=""><td class="line">116</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">117</td><td class="hits">3</td><td class="source">        tag.name = &quot;test&quot;;</td></tr><tr class="hit"><td class="line">118</td><td class="hits">3</td><td class="source">        t.equal(tag.name, &quot;test&quot;, &quot;name is null&quot;);</td></tr><tr class="hit"><td class="line">119</td><td class="hits">3</td><td class="source">        t.equal(tag.$dirty, true, &quot;dirty is null&quot;);</td></tr><tr class=""><td class="line">120</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">121</td><td class="hits">3</td><td class="source">        t.equal(tag.$data.name, &quot;test&quot;, &quot;data.name is null&quot;);</td></tr><tr class=""><td class="line">122</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">123</td><td class="hits">3</td><td class="source">        t.end();</td></tr><tr class=""><td class="line">124</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">125</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">126</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">127</td><td class="hits">3</td><td class="source">    test(&quot;drop tables&quot;, function (t) {</td></tr><tr class=""><td class="line">128</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">129</td><td class="hits">3</td><td class="source">        var deleteAll = fun.after(function () {</td></tr><tr class="hit"><td class="line">130</td><td class="hits">3</td><td class="source">            console.log(&quot;#deleted all tables&quot;);</td></tr><tr class="hit"><td class="line">131</td><td class="hits">3</td><td class="source">            t.end();</td></tr><tr class=""><td class="line">132</td><td class="hits"></td><td class="source">        });</td></tr><tr class=""><td class="line">133</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">134</td><td class="hits">3</td><td class="source">        dba.dropTable(&quot;users&quot;, deleteAll);</td></tr><tr class="hit"><td class="line">135</td><td class="hits">3</td><td class="source">        dba.dropTable(&quot;tags&quot;, deleteAll);</td></tr><tr class="hit"><td class="line">136</td><td class="hits">3</td><td class="source">        dba.dropTable(&quot;session&quot;, deleteAll);</td></tr><tr class=""><td class="line">137</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">138</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">139</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">140</td><td class="hits">3</td><td class="source">    test(&quot;check models&quot;, function (t) {</td></tr><tr class="hit"><td class="line">141</td><td class="hits">3</td><td class="source">        t.ok(norm.models.tags !== undefined);</td></tr><tr class="hit"><td class="line">142</td><td class="hits">3</td><td class="source">        t.equal(Tag.$table.fields.length, 4); // create_at + updated_at</td></tr><tr class=""><td class="line">143</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">144</td><td class="hits">3</td><td class="source">        t.ok(norm.models.sessions !== undefined);</td></tr><tr class="hit"><td class="line">145</td><td class="hits">3</td><td class="source">        t.equal(Session.$table.fields.length, 4); // create_at + updated_at</td></tr><tr class=""><td class="line">146</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">147</td><td class="hits">3</td><td class="source">        t.ok(norm.models.users !== undefined);</td></tr><tr class="hit"><td class="line">148</td><td class="hits">3</td><td class="source">        t.equal(User.$table.fields.length, 8); // create_at + updated_at</td></tr><tr class=""><td class="line">149</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">150</td><td class="hits">3</td><td class="source">        t.equal(User.$table.fields.indexOf(&quot;tag_id&quot;) !== -1, true, &quot;has user_perm_id field&quot;);</td></tr><tr class="hit"><td class="line">151</td><td class="hits">3</td><td class="source">        t.equal(User.$table.structure.tag_id.$dbtype, &quot;integer&quot;, &quot;fk is an integer&quot;);</td></tr><tr class="hit"><td class="line">152</td><td class="hits">3</td><td class="source">        t.equal(User.prototype.main_tag !== undefined, true, &quot;fk is an integer&quot;);</td></tr><tr class=""><td class="line">153</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">154</td><td class="hits">3</td><td class="source">        t.equal(User.$table.fields.indexOf(&quot;sess_id&quot;) !== -1, true, &quot;has user_perm_id field&quot;);</td></tr><tr class="hit"><td class="line">155</td><td class="hits">3</td><td class="source">        t.equal(User.$table.structure.sess_id.$dbtype, &quot;integer&quot;, &quot;fk is an integer&quot;);</td></tr><tr class="hit"><td class="line">156</td><td class="hits">3</td><td class="source">        t.equal(User.prototype.session, null, &quot;session property is null&quot;);</td></tr><tr class=""><td class="line">157</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">158</td><td class="hits"></td><td class="source"></td></tr><tr class=""><td class="line">159</td><td class="hits"></td><td class="source">        // REVIEW</td></tr><tr class=""><td class="line">160</td><td class="hits"></td><td class="source">        //t.deepEqual(User.prototype.mentors, [], &quot;mentors default is empty array&quot;);</td></tr><tr class=""><td class="line">161</td><td class="hits"></td><td class="source">        //t.equal(Session.prototype.owner !== undefined, true, &quot;fk is an integer&quot;);</td></tr><tr class=""><td class="line">162</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">163</td><td class="hits">3</td><td class="source">        t.end();</td></tr><tr class=""><td class="line">164</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">165</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">166</td><td class="hits">3</td><td class="source">    test(&quot;norm hasOne&quot;, function (t) {</td></tr><tr class="hit"><td class="line">167</td><td class="hits">3</td><td class="source">        var i,</td></tr><tr class=""><td class="line">168</td><td class="hits"></td><td class="source">            creates = [],</td></tr><tr class=""><td class="line">169</td><td class="hits"></td><td class="source">            alters = [],</td></tr><tr class=""><td class="line">170</td><td class="hits"></td><td class="source">            x;</td></tr><tr class=""><td class="line">171</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">172</td><td class="hits">3</td><td class="source">        for (i in ret) {</td></tr><tr class="hit"><td class="line">173</td><td class="hits">9</td><td class="source">            x = ret[i].$createTable();</td></tr><tr class="hit"><td class="line">174</td><td class="hits">9</td><td class="source">            creates.push(x[0]);</td></tr><tr class="hit"><td class="line">175</td><td class="hits">9</td><td class="source">            array.combine(alters, x[1]);</td></tr><tr class=""><td class="line">176</td><td class="hits"></td><td class="source">        }</td></tr><tr class=""><td class="line">177</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">178</td><td class="hits">3</td><td class="source">        array.combine(creates, alters);</td></tr><tr class=""><td class="line">179</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">180</td><td class="hits">3</td><td class="source">        dba.querys(creates, function () {</td></tr><tr class="hit"><td class="line">181</td><td class="hits">3</td><td class="source">            t.end();</td></tr><tr class=""><td class="line">182</td><td class="hits"></td><td class="source">        });</td></tr><tr class=""><td class="line">183</td><td class="hits"></td><td class="source">    });</td></tr><tr class=""><td class="line">184</td><td class="hits"></td><td class="source"></td></tr><tr class="hit"><td class="line">185</td><td class="hits">3</td><td class="source">    ret = {</td></tr><tr class=""><td class="line">186</td><td class="hits"></td><td class="source">        Tag: Tag,</td></tr><tr class=""><td class="line">187</td><td class="hits"></td><td class="source">        Session: Session,</td></tr><tr class=""><td class="line">188</td><td class="hits"></td><td class="source">        User: User</td></tr><tr class=""><td class="line">189</td><td class="hits"></td><td class="source">    };</td></tr><tr class="hit"><td class="line">190</td><td class="hits">3</td><td class="source">    return ret;</td></tr><tr class=""><td class="line">191</td><td class="hits"></td><td class="source">};</td></tr><tr class=""><td class="line">192</td><td class="hits"></td><td class="source"></td></tr></tbody>
          </table>
        </div></div>
    </div>
  </body>
</html>
